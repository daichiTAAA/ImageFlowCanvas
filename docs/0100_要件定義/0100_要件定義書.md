# 要件定義書

## **1. はじめに**

### **1.1. プロジェクトの目的**

本プロジェクトは、ユーザーがWebインターフェースを通じて、画像処理の各機能（前処理、AI処理、後処理など）を「部品」として自由に組み合わせ、動的な処理パイプラインを構築・実行できるシステムを開発することを目的とする。これにより、変化するビジネス要件や新しいAIモデルの導入に、迅速かつ柔軟に対応できる基盤を提供する。

### **1.2. プロジェクトの背景**

従来、画像処理パイプラインは固定的なものが多く、新しい処理の追加や順序の変更には多大な開発コストと時間を要していた。また、処理ごとに異なるライブラリや実行環境の依存関係の管理が複雑化し、システムの拡張性や保守性を著しく低下させる要因となっていた。本システムは、これらの課題を解決し、非エンジニアでも直感的に高度な画像処理ワークフローを構築できる環境を目指す。

### **1.3. 本書の構成**

本書は、開発するシステムの要件を定義するものである。システム概要、機能要件、非機能要件について記述する。

## **2. システム概要**

本システムは、画像処理の各機能を独立したコンポーネント（部品）として管理し、ユーザーがWebインターフェースを通じてこれらを自由に組み合わせて動的な処理パイプラインを構築・実行できるシステムである。

### **2.1. システムの特徴**

- **モジュラー設計**: 各画像処理機能を独立したコンポーネントとして実装し、柔軟な組み合わせを可能にする
- **動的パイプライン構築**: ユーザーが実行時に処理フローを定義・変更できる
- **スケーラブル実行**: 処理負荷に応じた動的なリソース割り当てと並列実行
- **リアルタイム監視**: パイプライン実行状況のリアルタイム可視化
- **マルチプロトコル対応**: 用途に応じた最適な通信プロトコルの選択

### **2.2. 対象ユーザー**

- **エンドユーザー**: パイプラインを設計・実行する業務担当者
- **開発者**: 新しい処理コンポーネントを開発・登録する技術者
- **運用者**: システムの監視・保守を行う運用担当者
- **検査作業者**: 製造現場でモバイルアプリを使用して検査業務を実施する作業者
- **品質管理者**: 検査結果の分析・管理を行う品質保証部門の担当者

## **3. 機能要件**

### **3.1. パイプライン管理機能**

#### **🔄 F-001: パイプラインの動的構築**
- **概要**: ユーザーはWeb UI上で、登録済みの処理コンポーネント（部品）をドラッグ＆ドロップ等の直感的な操作で選択し、それらの実行順序や依存関係（直列・並列）を定義できる
- **優先度**: 🔴 High
- **入力**: 処理コンポーネント一覧、パイプライン設計画面
- **出力**: パイプライン定義（YAML/JSON）

#### **▶️ F-002: パイプラインの実行**  
- **概要**: ユーザーは構築したパイプラインを、任意の入力データ（画像など）を指定して実行できる。実行時に特定のパラメータ（リサイズ幅など）を動的に上書きできる
- **優先度**: 🔴 High
- **入力**: パイプライン定義、入力データ、実行時パラメータ
- **出力**: 実行ID、初期ステータス

#### **👁️ F-003: パイプラインの実行監視**
- **概要**: 実行中のパイプラインの進捗状況をリアルタイムで可視化する。各ステップの成功、失敗、実行中といったステータスが一覧できる
- **優先度**: 🟡 Medium
- **入力**: 実行ID
- **出力**: リアルタイムステータス表示

#### **📊 F-004: 実行履歴と結果確認**
- **概要**: 過去に実行したパイプラインの履歴を一覧表示できる。各実行の詳細（使用したパラメータ、ログ、生成された成果物）を確認できる
- **優先度**: 🟡 Medium  
- **入力**: 検索条件（日付、ステータス等）
- **出力**: 実行履歴一覧、詳細情報

#### **🔄 F-005: エラーハンドリング**
- **概要**: パイプラインの特定のステップが失敗した場合、定義されたリトライ処理を自動で実行する
- **優先度**: 🟡 Medium
- **入力**: エラー情報、リトライ設定
- **出力**: リトライ実行結果

### **3.2. 処理コンポーネント（部品）管理機能**

#### **📦 F-006: コンポーネントの登録**
- **概要**: 開発者は、新しい処理ロジックを実装したコンテナイメージをシステムに登録できる。登録時には、コンポーネントの名前、説明、入出力パラメータの定義を行う
- **優先度**: 🔴 High
- **入力**: コンテナイメージ、メタデータ（名前、説明、パラメータ定義）
- **出力**: コンポーネントID、登録確認

#### **🏷️ F-007: コンポーネントのバージョン管理**
- **概要**: 各処理コンポーネントはバージョン管理され、パイプライン定義時には使用するバージョンを明示的に指定できる
- **優先度**: 🟡 Medium
- **入力**: コンポーネントID、バージョン情報
- **出力**: バージョン履歴、利用可能バージョン一覧

### **3.3. データ管理機能**

#### **📥 F-008: 外部クライアントからの画像データ受信**
- **概要**: 外部クライアントシステムから画像データを受信する機能を提供する
- **優先度**: 🔴 High
- **入力**: 画像データ（バイナリ）、パイプライン設定、メタデータ
- **出力**: 受信確認、データID、処理キューへの登録

#### **🔄 F-018: ストリーミング画像処理**
- **概要**: 大容量画像や連続的な画像ストリームを効率的に処理する機能を提供する
- **優先度**: 🟡 Medium
- **入力**: 画像チャンクストリーム、ストリーミング設定
- **出力**: リアルタイム処理結果

#### **📡 F-019: マルチプロトコル対応**
- **概要**: クライアント要件に応じて最適なプロトコルを自動選択する機能を提供する
- **優先度**: 🟡 Medium
- **入力**: プロトコル指定、クライアント認証情報
- **出力**: プロトコル固有のレスポンス

#### **💾 F-009: データストレージ**
- **概要**: 受け付けた入力データ、およびパイプラインの各ステップで生成される中間・最終成果物を、オブジェクトストレージに永続的に保存する
- **優先度**: 🔴 High
- **入力**: データファイル、保存先パス
- **出力**: ストレージURL、保存確認

### **3.4. ユーザーインターフェース (UI)**

#### **📊 F-010: ダッシュボード**
- **概要**: パイプラインの実行状況やシステムの状態を概観できるダッシュボードを提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 実行中パイプライン数表示
  - システムリソース使用状況
  - 最近の実行履歴
  - エラー/警告アラート

#### **🎨 F-011: パイプライン定義画面**
- **概要**: F-001で定義した、パイプラインをグラフィカルに構築するための専用画面を提供する
- **優先度**: 🔴 High
- **機能**:
  - ドラッグ＆ドロップによるコンポーネント配置
  - 接続線による依存関係の定義
  - パラメータ設定画面
  - プレビュー機能

#### **📈 F-012: 実行結果表示画面**
- **概要**: F-004で定義した、パイプラインの実行結果（生成画像、ログ等）を詳細に表示する画面を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 実行ログの表示
  - 生成された画像の表示
  - 実行時間の表示
  - エラー詳細の表示

#### **📱 F-016: 実行監視画面**
- **概要**: リアルタイムでパイプラインの実行状況を監視する専用画面を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 実行中パイプラインの一覧表示
  - 各ステップの進捗状況をグラフィカルに表示
  - エラー発生時のアラート表示
  - 実行キャンセル機能
  - リアルタイムログストリーミング

#### **🖼️ F-017: 画像比較・プレビュー画面**
- **概要**: 入力画像と各処理ステップの出力画像を比較表示する機能を提供する
- **優先度**: 🔵 Low
- **機能**:
  - Before/After比較表示
  - 各ステップの中間結果表示
  - 画像の拡大・縮小・パン操作
  - メタデータ（ファイルサイズ、解像度等）の表示

### **3.6. 検査アプリ機能**

#### **📋 F-020: 検査マスタ管理**
- **概要**: 検査対象となる製品・部品の情報と検査項目を一元管理する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 製品・部品情報の登録・編集・削除
  - 検査項目の定義（外観検査、寸法検査、機能検査等）
  - 検査基準の設定（OK/NG判定基準、許容範囲等）
  - 検査手順書の添付
  - マスタデータのバージョン管理

#### **📱 F-021: モバイル検査アプリ**
- **概要**: 現場作業者が使用するモバイルアプリケーションで検査業務を実行する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - QRコード/バーコードによる検査対象の識別
  - 検査項目一覧の表示
  - カメラ機能による画像撮影
  - 撮影画像のプレビュー・再撮影
  - オフライン対応（ネットワーク接続時に同期）
  - 検査進捗の表示

#### **🤖 F-022: AI自動検査**
- **概要**: 撮影された画像に対してAIモデルを用いた自動検査を実行する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - Web UIで定義したパイプラインを使用して画像処理を実行
  - 画像解析による外観検査（キズ、汚れ、変形等の検出）
  - 寸法測定（画像解析による長さ・面積計測）
  - 文字認識（製品番号、ロット番号等の読み取り）
  - 色彩検査（色差測定、色調確認）
  - 検査結果の信頼度スコア表示
  - AI判定の根拠画像生成（検出箇所のハイライト）

#### **👤 F-023: 人による検査結果入力**
- **概要**: AIによる自動検査に加えて、人が目視で確認した結果を入力する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - AI判定結果の確認・修正
  - 人による追加検査項目の入力
  - OK/NG判定の最終決定
  - 不良内容の詳細記録（不良箇所、重要度等）
  - コメント・備考の入力
  - 検査者情報の記録

#### **📊 F-024: 検査結果管理**
- **概要**: 実施された検査の結果を一元管理し、分析・報告機能を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 検査結果の一覧表示・検索
  - 検査履歴の追跡
  - 統計データの生成（合格率、不良率等）
  - 検査レポートの自動生成
  - 検査データのエクスポート（CSV、PDF等）
  - トレーサビリティ情報の管理

#### **🔔 F-025: 検査アラート・通知**
- **概要**: 検査結果に基づいて適切な関係者に通知を送信する機能を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 不良品検出時の即座アラート
  - 検査完了通知
  - 異常傾向の検出・通知
  - エスカレーション機能
  - 通知方法の選択（メール、プッシュ通知、システム内通知）

#### **📈 F-026: 検査品質分析**
- **概要**: 蓄積された検査データを分析し、品質改善のための洞察を提供する機能
- **優先度**: 🔵 Low
- **機能**:
  - 不良傾向分析
  - 検査工程の効率性分析
  - AI判定精度の評価・改善提案
  - 品質ダッシュボード
  - 予防保全のための予測分析

### **3.7. リアルタイム通信機能**

#### **🔔 F-013: リアルタイム進捗通知**
- **概要**: パイプラインの実行中、各ステップの開始・完了・エラー情報をWeb UIにリアルタイムで通知する
- **優先度**: 🟡 Medium
- **入力**: 進捗メッセージ
- **出力**: Web UIへのリアルタイム通知

#### **📡 F-014: 結果配信API**
- **概要**: 処理完了後、最終結果（画像ファイル、メタデータ）を外部システムに配信する機能を提供する
- **優先度**: 🟡 Medium
- **入力**: 実行ID、配信先情報
- **出力**: 結果データ（画像、JSON）

#### **🔄 F-015: ステータス同期**
- **概要**: Web UIで表示される実行状況と、実際のパイプライン実行状況をリアルタイム同期する
- **優先度**: 🔴 High
- **入力**: リアルタイムメッセージ
- **出力**: UI状態の更新

#### **📱 F-027: モバイル-サーバー間同期**
- **概要**: モバイル検査アプリとサーバー間でデータの双方向同期を行う機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - オフライン時のデータ蓄積
  - ネットワーク復旧時の自動同期
  - 検査マスタデータの定期同期
  - 検査結果のリアルタイム送信
  - 競合解決機能

#### **⚡ F-028: 検査結果リアルタイム配信**
- **概要**: 検査完了と同時に結果を関係システムにリアルタイム配信する機能を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 製造実行システム（MES）への結果送信
  - 品質管理システムへの不良情報配信
  - ダッシュボードへのリアルタイム反映
  - Webhookによる外部システム連携

## **4. 非機能要件**

### **4.1. 性能・拡張性 (Performance & Scalability)**

#### **⚡ NF-001: スループット**
- **要求**: システムは、単位時間あたりに指定された数のパイプラインを処理できること
- **詳細**: ボトルネックとなっている処理コンポーネントを特定し、個別にスケールアウトできる構成であること
- **測定方法**: 同時実行パイプライン数、平均処理時間

#### **📈 NF-002: スケーラビリティ**
- **要求**: 将来的な処理負荷の増大に対応するため、パイプライン実行サーバー（ワーカーノード）をクラスタに容易に追加できること
- **詳細**: 水平スケーリング対応、自動スケーリング機能
- **測定方法**: ノード追加時間、負荷分散効率

#### **🎯 NF-003: リソースの効率的利用**
- **要求**: 処理の性質に応じて適切なコンピューティングリソースを割り当てられること
- **詳細**: リソース要件に基づく動的リソース割り当て
- **測定方法**: リソース使用率、コスト効率

### **4.2. 可用性・信頼性 (Availability & Reliability)**

#### **🛡️ NF-004: 耐障害性**
- **要求**: 特定の処理コンポーネントで障害が発生しても、その影響が他のコンポーネントやパイプライン全体に波及しないこと
- **詳細**: 障害が発生したコンポーネントは自動的に復旧されること
- **測定方法**: MTTR（平均復旧時間）、障害影響範囲

#### **💾 NF-005: データ永続性**
- **要求**: 入力データ、中間成果物、最終成果物は、システム障害によって失われないこと
- **詳細**: 永続化ストレージへの確実な保存
- **測定方法**: データ損失率、バックアップ復旧時間

### **4.3. 運用・保守性 (Operability & Maintainability)**

#### **👁️ NF-006: 監視**
- **要求**: システムを構成する各コンポーネントのリソース使用率（CPU、メモリ）や、アプリケーション固有のメトリクスを収集し、可視化できること
- **詳細**: ダッシュボード、アラート機能
- **測定方法**: 監視カバレッジ、アラート精度

#### **📝 NF-007: ロギング**
- **要求**: 全ての処理コンポーネントから出力されるログを一元的に収集し、検索・分析できること
- **詳細**: 構造化ログ、ログ保持期間設定
- **測定方法**: ログ検索性能、ログ完全性

#### **🚀 NF-008: デプロイの自動化**
- **要求**: 処理コンポーネントのソースコードが更新された際、自動的にビルドとデプロイが行われるCI/CDパイプラインを構築できること
- **詳細**: 自動化されたビルド・テスト・デプロイプロセス
- **測定方法**: デプロイ時間、自動化率

### **4.4. セキュリティ (Security)**

#### **🔐 NF-009: アクセス制御**
- **要求**: システムへのアクセスは、適切な認証・認可によって制御されること
- **詳細**: RBAC（Role-Based Access Control）、多要素認証
- **測定方法**: アクセス制御違反数、認証成功率

#### **🔒 NF-010: 機密情報管理**
- **要求**: データベースのパスワードやAPIキーなどの機密情報は、ソースコードにハードコーディングせず、適切な仕組みを用いて安全に管理すること
- **詳細**: 暗号化、Secret管理
- **測定方法**: 機密情報露出リスク評価

### **4.5. モバイル・UX (Mobile & User Experience)**

#### **📱 NF-012: モバイル対応**
- **要求**: 検査アプリは様々なモバイルデバイス（スマートフォン、タブレット）で安定動作すること
- **詳細**: iOS/Android対応、画面サイズ適応、バッテリー効率性
- **測定方法**: デバイス互換性、バッテリー持続時間、UI応答性

#### **🔌 NF-013: オフライン対応**
- **要求**: ネットワーク接続が不安定な現場環境でも検査業務が継続できること
- **詳細**: ローカルデータ保存、自動同期機能、差分更新
- **測定方法**: オフライン動作時間、同期成功率、データ整合性

#### **🎯 NF-014: UI/UX要件**
- **要求**: 現場作業者が手袋をしたまま操作できる直感的なインターフェースであること
- **詳細**: 大きなタップターゲット、音声フィードバック、シンプルな操作フロー
- **測定方法**: ユーザビリティテストスコア、操作エラー率、作業効率向上率

### **4.6. 移行性 (Portability)**

#### **☁️ NF-015: クラウド非依存**
- **要求**: システムはオープンソースの技術を主軸とし、特定のクラウドベンダーの独自サービスへの依存を最小限に抑えること
- **詳細**: 将来的なオンプレミス環境や他クラウドへの移行が容易であること
- **測定方法**: ベンダーロックイン度、移行工数

## **5. その他**

### **5.1. 用語集**

| 英語 / 日本語                                  | 説明                                                                 |
| :--------------------------------------------- | :------------------------------------------------------------------- |
| **Pipeline / パイプライン**                    | 画像処理の各ステップ（リサイズ、AI処理など）を連結した処理フロー     |
| **Component / コンポーネント**                 | 独立した画像処理機能を実装した処理単位。パイプラインの構成要素となる |
| **Execution / 実行**                           | 定義されたパイプラインを実際に動作させること                         |
| **Node / ノード**                              | 処理を実行するコンピューティングリソースの単位                       |
| **Pod / ポッド**                               | コンテナの集合体。1つ以上のコンテナが協調して動作する単位            |
| **Real-time Processing / リアルタイム処理**    | 低遅延での画像処理を要求される処理形態                               |
| **Batch Processing / バッチ処理**              | 大量データを一括で処理する処理形態                                   |
| **DAG / 有向非巡回グラフ**                     | パイプラインの処理フローを表現するデータ構造                         |
| **Streaming / ストリーミング**                 | 連続的なデータフローでの処理方式                                     |
| **Scalability / スケーラビリティ**             | システムの拡張性。負荷増加に対応してリソースを追加できる能力         |
| **Monitoring / 監視**                          | システムの状態やパフォーマンスを継続的に観測すること                 |
| **Authentication / 認証**                      | ユーザーやシステムの身元を確認すること                               |
| **Authorization / 認可**                       | 認証されたユーザーに対してアクセス権限を付与すること                 |
| **Inspection Master / 検査マスタ**             | 検査対象の製品・部品情報と検査項目を定義したマスタデータ             |
| **Mobile Inspection App / モバイル検査アプリ** | 現場作業者が使用する検査業務専用のモバイルアプリケーション           |
| **AI Inspection / AI検査**                     | 人工知能技術を用いた画像解析による自動検査                           |
| **Visual Inspection / 外観検査**               | 製品の表面状態や外観品質を確認する検査                               |
| **Quality Control / 品質管理**                 | 製品の品質を維持・向上させるための管理活動                           |
| **Traceability / トレーサビリティ**            | 製品の履歴や検査結果を追跡可能にする仕組み                           |
| **Offline Sync / オフライン同期**              | ネットワーク未接続時のデータ保存と接続回復時の自動同期               |
| **QR Code / QRコード**                         | 検査対象を識別するための二次元バーコード                             |

### **5.2. 制約事項**

#### **技術的制約**
- 処理コンポーネントはコンテナ化されている必要がある
- 画像データは標準的なフォーマット（JPEG、PNG、TIFF等）に対応する
- パイプライン定義は構造化された形式（JSON/YAML）で記述される
- モバイルアプリはiOS 12.0以上、Android 8.0以上に対応する
- 検査用カメラは最低800万画素以上の解像度が必要

#### **運用制約**  
- システムの稼働時間は24時間365日を想定する
- 定期メンテナンス時間は事前に通知される
- データ保持期間は運用ポリシーに従って設定される
- 検査データは法的要件に応じて長期保存される
- オフライン環境での検査業務継続性を考慮する

#### **セキュリティ制約**
- 機密データは暗号化して保存される
- アクセスログは監査要件に従って保持される
- 外部システムとの通信は暗号化される
- 検査結果の改ざん防止機能が実装される
- 個人情報（検査者情報等）は適切に保護される