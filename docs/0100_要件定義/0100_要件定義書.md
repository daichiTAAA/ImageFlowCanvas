# 要件定義書

## **1. はじめに**

### **1.1. プロジェクトの目的**

本プロジェクトは、ユーザーがWebインターフェースを通じて、画像処理の各機能（前処理、AI処理、後処理など）を「部品」として自由に組み合わせ、動的な処理パイプラインを構築・実行できるシステムを開発することを目的とする。これにより、変化するビジネス要件や新しいAIモデルの導入に、迅速かつ柔軟に対応できる基盤を提供する。

### **1.2. プロジェクトの背景**

従来、画像処理パイプラインは固定的なものが多く、新しい処理の追加や順序の変更には多大な開発コストと時間を要していた。また、処理ごとに異なるライブラリや実行環境の依存関係の管理が複雑化し、システムの拡張性や保守性を著しく低下させる要因となっていた。

### **1.3. 本書の構成**

本書は、開発するシステムの要件を定義するものである。システム概要、機能要件、非機能要件について記述する。

## **2. システム概要**

本システムは、画像処理の各機能を独立したコンポーネント（部品）として管理し、ユーザーがWebインターフェースを通じてこれらを自由に組み合わせて動的な処理パイプラインを構築・実行できるシステムである。

### **2.1. システムの特徴**

- **モジュラー設計**: 各画像処理機能を独立したコンポーネントとして実装し、柔軟な組み合わせを可能にする
- **動的パイプライン構築**: ユーザーが実行時に処理フローを定義・変更できる
- **スケーラブル実行**: 処理負荷に応じた動的なリソース割り当てと並列実行
- **リアルタイム監視**: パイプライン実行状況のリアルタイム可視化
- **マルチプロトコル対応**: 用途に応じた最適な通信プロトコルの選択

### **2.2. 対象ユーザー**

- **エンドユーザー**: パイプラインを設計・実行する業務担当者
- **開発者**: 新しい処理コンポーネントを開発・登録する技術者
- **運用者**: システムの監視・保守を行う運用担当者
- **検査作業者**: 製造現場でモバイルアプリやハンディターミナル端末を使用して検査業務を実施する作業者
- **品質管理者**: 検査結果の分析・管理を行う品質保証部門の担当者
- **ウェアラブルデバイス装着者**: THINKLETなどのウェアラブルデバイスを装着し、一人称映像による検査・記録を実施する現場作業者

## **3. 機能要件**

### **3.1. パイプライン管理機能**

#### **🔄 F-001: パイプラインの動的構築**
- **概要**: ユーザーはWeb UI上で、登録済みの処理コンポーネント（部品）をドラッグ＆ドロップ等の直感的な操作で選択し、それらの実行順序や依存関係（直列・並列）を定義できる
- **優先度**: 🔴 High
- **入力**: 処理コンポーネント一覧、パイプライン設計画面
- **出力**: パイプライン定義（YAML/JSON）

#### **▶️ F-002: パイプラインの実行**  
- **概要**: ユーザーは構築したパイプラインを、任意の入力データ（画像など）を指定して実行できる。実行時に特定のパラメータ（リサイズ幅など）を動的に上書きできる
- **優先度**: 🔴 High
- **入力**: パイプライン定義、入力データ、実行時パラメータ
- **出力**: 実行ID、初期ステータス

#### **👁️ F-003: パイプラインの実行監視**
- **概要**: 実行中のパイプラインの進捗状況をリアルタイムで可視化する。各ステップの成功、失敗、実行中といったステータスが一覧できる
- **優先度**: 🟡 Medium
- **入力**: 実行ID
- **出力**: リアルタイムステータス表示

#### **📊 F-004: 実行履歴と結果確認**
- **概要**: 過去に実行したパイプラインの履歴を一覧表示できる。各実行の詳細（使用したパラメータ、ログ、生成された成果物）を確認できる
- **優先度**: 🟡 Medium  
- **入力**: 検索条件（日付、ステータス等）
- **出力**: 実行履歴一覧、詳細情報

#### **🔄 F-005: エラーハンドリング**
- **概要**: パイプラインの特定のステップが失敗した場合、定義されたリトライ処理を自動で実行する
- **優先度**: 🟡 Medium
- **入力**: エラー情報、リトライ設定
- **出力**: リトライ実行結果

### **3.2. 処理コンポーネント（部品）管理機能**

#### **📦 F-006: コンポーネントの登録**
- **概要**: 開発者は、新しい処理ロジックを実装したコンテナイメージをシステムに登録できる。登録時には、コンポーネントの名前、説明、入出力パラメータの定義を行う
- **優先度**: 🔴 High
- **入力**: コンテナイメージ、メタデータ（名前、説明、パラメータ定義）
- **出力**: コンポーネントID、登録確認

#### **🏷️ F-007: コンポーネントのバージョン管理**
- **概要**: 各処理コンポーネントはバージョン管理され、パイプライン定義時には使用するバージョンを明示的に指定できる
- **優先度**: 🟡 Medium
- **入力**: コンポーネントID、バージョン情報
- **出力**: バージョン履歴、利用可能バージョン一覧

### **3.3. データ管理機能**

#### **📥 F-008: 外部クライアントからの画像データ受信**
- **概要**: 外部クライアントシステムから画像データを受信する機能を提供する
- **優先度**: 🔴 High
- **入力**: 画像データ（バイナリ）、パイプライン設定、メタデータ
- **出力**: 受信確認、データID、処理キューへの登録

#### **🔄 F-018: ストリーミング画像処理**
- **概要**: 大容量画像や連続的な画像ストリームを効率的に処理する機能を提供する
- **優先度**: 🟡 Medium
- **入力**: 画像チャンクストリーム、ストリーミング設定
- **出力**: リアルタイム処理結果

#### **📡 F-019: マルチプロトコル対応**
- **概要**: クライアント要件に応じて最適なプロトコルを自動選択する機能を提供する
- **優先度**: 🟡 Medium
- **入力**: プロトコル指定、クライアント認証情報
- **出力**: プロトコル固有のレスポンス

#### **💾 F-009: データストレージ**
- **概要**: 受け付けた入力データ、およびパイプラインの各ステップで生成される中間・最終成果物を、オブジェクトストレージに永続的に保存する
- **優先度**: 🔴 High
- **入力**: データファイル、保存先パス
- **出力**: ストレージURL、保存確認

### **3.4. ユーザーインターフェース (UI)**

#### **📊 F-010: ダッシュボード**
- **概要**: パイプラインの実行状況やシステムの状態を概観できるダッシュボードを提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 実行中パイプライン数表示
  - システムリソース使用状況
  - 最近の実行履歴
  - エラー/警告アラート

#### **🎨 F-011: パイプライン定義画面**
- **概要**: F-001で定義した、パイプラインをグラフィカルに構築するための専用画面を提供する
- **優先度**: 🔴 High
- **機能**:
  - ドラッグ＆ドロップによるコンポーネント配置
  - 接続線による依存関係の定義
  - パラメータ設定画面
  - プレビュー機能

#### **📈 F-012: 実行結果表示画面**
- **概要**: F-004で定義した、パイプラインの実行結果（生成画像、ログ等）を詳細に表示する画面を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 実行ログの表示
  - 生成された画像の表示
  - 実行時間の表示
  - エラー詳細の表示

#### **📱 F-016: 実行監視画面**
- **概要**: リアルタイムでパイプラインの実行状況を監視する専用画面を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 実行中パイプラインの一覧表示
  - 各ステップの進捗状況をグラフィカルに表示
  - エラー発生時のアラート表示
  - 実行キャンセル機能
  - リアルタイムログストリーミング

#### **🖼️ F-017: 画像比較・プレビュー画面**
- **概要**: 入力画像と各処理ステップの出力画像を比較表示する機能を提供する
- **優先度**: 🔵 Low
- **機能**:
  - Before/After比較表示
  - 各ステップの中間結果表示
  - 画像の拡大・縮小・パン操作
  - メタデータ（ファイルサイズ、解像度等）の表示

### **3.6. 検査アプリ機能**

#### **📋 F-020: 検査マスタ管理**
- **概要**: 検査指示となる製品・部品の情報と検査項目を一元管理する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 製品・部品情報の登録・編集・削除
  - 検査項目の定義（外観検査、寸法検査、機能検査等）
  - 検査基準の設定（OK/NG判定基準、許容範囲等）
  - 検査手順書の添付
  - マスタデータのバージョン管理

#### **📱 F-021: モバイル検査アプリ**
- **概要**: 現場作業者が使用するモバイルアプリケーションで検査業務を実行する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - QRコード/バーコードによる検査指示の識別
  - 検査項目一覧の表示
  - カメラ機能による画像撮影
  - 撮影画像のプレビュー・再撮影
  - オフライン対応（ネットワーク接続時に同期）
  - 検査進捗の表示

#### **📱 F-021-1: QRコード情報取得機能**
- **概要**: QRコードをスキャンして指図番号・指示番号・型式・機番・生産年月日・月連番順序情報を取得する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - QRコードの高速スキャンと情報の自動デコード
  - 指図番号・指示番号・型式・機番・生産年月日・月連番順序情報の表示
  - スキャン履歴の保存と検索
  - エラー時の再スキャン機能
  - スキャン音・バイブレーションによるフィードバック

#### **📱 F-021-2: サーバー情報取得機能**
- **概要**: サーバーから指図番号・指示番号・型式・機番・生産年月日・月連番情報を検索・取得する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 製品情報検索インターフェース（製品名、型式、機番等による検索）
  - サーバーから取得した指図番号・指示番号・型式・機番・生産年月日・月連番情報の表示
  - 検索履歴の保存と再利用
  - オートコンプリート機能による検索支援
  - オフライン時のキャッシュデータ利用

#### **🤖 F-022: AI自動検査**
- **概要**: 撮影された画像に対してAIモデルを用いた自動検査を実行する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - Web UIで定義したパイプラインを使用して画像処理を実行
  - 画像解析による外観検査（キズ、汚れ、変形等の検出）
  - 寸法測定（画像解析による長さ・面積計測）
  - 文字認識（製品番号、ロット番号等の読み取り）
  - 色彩検査（色差測定、色調確認）
  - 検査結果の信頼度スコア表示
  - AI判定の根拠画像生成（検出箇所のハイライト）

#### **👤 F-023: 人による検査結果入力**
- **概要**: AIによる自動検査に加えて、人が目視で確認した結果を入力する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - AI判定結果の確認・修正
  - 人による追加検査項目の入力
  - OK/NG判定の最終決定
  - 不良内容の詳細記録（不良箇所、重要度等）
  - コメント・備考の入力
  - 検査者情報の記録

#### **📊 F-024: 検査結果管理**
- **概要**: 実施された検査の結果を一元管理し、分析・報告機能を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 検査結果の一覧表示・検索
  - 検査履歴の追跡
  - 統計データの生成（合格率、不良率等）
  - 検査レポートの自動生成
  - 検査データのエクスポート（CSV、PDF等）
  - トレーサビリティ情報の管理

#### **📊 F-024-1: 検査結果の製品情報紐づけ記録**
- **概要**: 検査結果の記録時に指図番号・指示番号・型式・機番・月連番を紐づけてサーバーに保存する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 検査結果記録時の製品情報自動紐づけ
  - 指図番号・指示番号・型式・機番・月連番の必須入力チェック
  - 検査結果と製品情報の整合性検証
  - 紐づけデータの一括登録・更新機能
  - 製品情報による検査結果検索・フィルタリング
  - トレーサビリティレポートの生成（製品情報ベース）

#### **🔔 F-025: 検査アラート・通知**
- **概要**: 検査結果に基づいて適切な関係者に通知を送信する機能を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 不良品検出時の即座アラート
  - 検査完了通知
  - 異常傾向の検出・通知
  - エスカレーション機能
  - 通知方法の選択（メール、プッシュ通知、システム内通知）

#### **📈 F-026: 検査品質分析**
- **概要**: 蓄積された検査データを分析し、品質改善のための洞察を提供する機能
- **優先度**: 🔵 Low
- **機能**:
  - 不良傾向分析
  - 検査工程の効率性分析
  - AI判定精度の評価・改善提案
  - 品質ダッシュボード
  - 予防保全のための予測分析

### **3.7. リアルタイム通信機能**

#### **🔔 F-013: リアルタイム進捗通知**
- **概要**: パイプラインの実行中、各ステップの開始・完了・エラー情報をWeb UIにリアルタイムで通知する
- **優先度**: 🟡 Medium
- **入力**: 進捗メッセージ
- **出力**: Web UIへのリアルタイム通知

#### **📡 F-014: 結果配信API**
- **概要**: 処理完了後、最終結果（画像ファイル、メタデータ）を外部システムに配信する機能を提供する
- **優先度**: 🟡 Medium
- **入力**: 実行ID、配信先情報
- **出力**: 結果データ（画像、JSON）

#### **🔄 F-015: ステータス同期**
- **概要**: Web UIで表示される実行状況と、実際のパイプライン実行状況をリアルタイム同期する
- **優先度**: 🔴 High
- **入力**: リアルタイムメッセージ
- **出力**: UI状態の更新

#### **📱 F-027: モバイル-サーバー間同期**
- **概要**: モバイル検査アプリとサーバー間でデータの双方向同期を行う機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - オフライン時のデータ蓄積
  - ネットワーク復旧時の自動同期
  - 検査マスタデータの定期同期
  - 検査結果のリアルタイム送信
  - 競合解決機能

#### **⚡ F-028: 検査結果リアルタイム配信**
- **概要**: 検査完了と同時に結果を関係システムにリアルタイム配信する機能を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 製造実行システム（MES）への結果送信
  - 品質管理システムへの不良情報配信
  - ダッシュボードへのリアルタイム反映
  - Webhookによる外部システム連携

### **3.8. ハンディターミナル端末検査機能**

#### **🔲 F-029: ハンディターミナル端末による現場検査**
- **概要**: 作業現場でハンディターミナル端末を使用した検査業務を効率的に実行する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 物理的な撮影ボタンによるワンタッチ検査開始
  - 厚手の手袋装着時でも確実に操作可能な物理ボタン設計
  - 撮影から結果表示までの自動化されたワークフロー
  - 高輝度ディスプレイによる屋外・強照明下での視認性確保
  - 防塵・防水・耐衝撃設計（IP65相当）
  - 油汚れ・化学物質に対する耐性
  - 長時間連続使用可能なバッテリー（8時間以上）

#### **📷 F-029-1: 物理ボタンによる検査撮影**
- **概要**: ハンディターミナル端末の物理撮影ボタンを押すだけで検査撮影と処理を自動実行する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 大型物理シャッターボタン（厚手手袋対応）
  - ボタン押下による即座の高解像度撮影
  - 撮影完了の触覚・音声・視覚フィードバック
  - 撮影失敗時の自動再撮影案内
  - ボタンの誤操作防止機構
  - カメラの自動フォーカス・露出調整
  - 手ぶれ補正機能の自動適用

#### **🤖 F-029-2: 自動検査処理・結果記録**
- **概要**: 撮影された画像に対してAI検査を自動実行し、結果を記録・表示する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 撮影と同時に開始されるAI検査パイプライン
  - リアルタイム画像解析と品質判定
  - 検査結果の自動記録（OK/NG、信頼度スコア）
  - 不良箇所の自動検出・マーキング
  - 検査データの製品情報への自動紐づけ
  - 検査履歴の即座データベース保存
  - 結果確認までの処理時間最適化（<3秒）

#### **🖥️ F-029-3: 現場向け検査結果表示**
- **概要**: 検査結果を現場作業者にとって理解しやすい形で表示する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 大きく明確なOK/NG表示（色とアイコンによる判別）
  - 不良箇所の視覚的ハイライト表示
  - 信頼度スコアの分かりやすい表示
  - 検査基準値との比較表示
  - 次の検査項目への自動案内
  - エラー・注意事項の音声案内
  - 手袋装着時でも操作可能な大きなボタン配置

#### **🔋 F-029-4: 長時間バッテリー動作**
- **概要**: ハンディターミナル端末が現場での長時間検査業務に対応できるバッテリー性能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 連続8時間以上の検査業務対応
  - 省電力モードによる待機時間延長
  - バッテリー残量の明確な表示・警告
  - 急速充電対応（休憩時間での素早い充電）
  - 外部バッテリーパック対応
  - 電力消費の最適化（画面輝度自動調整等）
  - 低電力時の自動データ保存・同期

#### **🛡️ F-029-5: 耐久性・耐環境性能**
- **概要**: 工場・現場環境での使用に耐える堅牢なハンディターミナル端末性能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 防塵・防水性能（IP65相当）
  - 耐衝撃性能（落下・振動耐性）
  - 油汚れ・化学物質への耐性
  - 高温・低温環境での動作保証（-10℃〜+50℃）
  - 直射日光下での画面視認性確保
  - 電磁波ノイズ耐性
  - 長期使用による劣化への対応

### **3.9. ウェアラブルデバイス機能**

#### **🎥 F-030: ウェアラブルデバイスでの一人称映像録画**
- **概要**: THINKLETなどのウェアラブルデバイスで撮影した一人称映像を録画・保存する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 高画質映像の連続録画（8MP、120度視野角対応）
  - 一人称視点による作業プロセスの記録
  - 映像ファイルの自動保存・管理
  - タイムスタンプと位置情報の付与
  - バッテリー効率を考慮した録画設定
  - オフライン時のローカル保存とクラウド同期

#### **🎥 F-030-1: 一人称映像の製品情報紐づけ記録**
- **概要**: 一人称映像の記録時に指図番号・指示番号・型式・機番・月連番を紐づけてサーバーに保存する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 録画開始時の製品情報自動紐づけ（QRコードスキャンまたはサーバー検索による）
  - 映像ファイルのメタデータへの製品情報埋め込み
  - 指図番号・指示番号・型式・機番・月連番による映像検索・フィルタリング
  - 製品情報と映像タイムスタンプの連携記録
  - 作業工程別映像セグメンテーション（製品情報ベース）
  - 製品トレーサビリティと映像証跡の統合管理

#### **🔍 F-031: ウェアラブルデバイスでのリアルタイム不良検査**
- **概要**: ウェアラブルデバイスで撮影した一人称映像をリアルタイムでAI解析し、不良品を即座に検出する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - リアルタイム映像ストリームの処理（<20ms遅延）
  - AI検査パイプラインの動的適用
  - 不良品検出時の即座アラート（視覚・音声）
  - 検出結果の一人称映像への重畳表示
  - 信頼度スコアとヒートマップの表示
  - 検査履歴の自動記録

#### **🎙️ F-032: ウェアラブルデバイス音声入力**
- **概要**: ウェアラブルデバイスの高性能マイクを使用した音声入力機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 5chマイクアレイによる高品質音声収集
  - 環境騒音抑制（XFE技術対応）
  - 装着者の声のみを選択的に集音
  - 音声コマンドによる検査操作
  - 音声メモの録音・テキスト化
  - 多言語音声認識対応

#### **🔊 F-033: ウェアラブルデバイス情報伝達**
- **概要**: ウェアラブルデバイスのスピーカーや外部音声出力を使用した情報伝達機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 検査結果の音声通知
  - 作業手順の音声ガイダンス
  - エラー・アラートの音声フィードバック
  - Bluetoothイヤホン対応
  - 騒音環境での音量自動調整
  - 緊急時の優先通知機能

#### **🖥️ F-034: ウェアラブルデバイス不良判定結果のデスクトップ表示**
- **概要**: ウェアラブルデバイスで撮影した一人称映像のリアルタイム不良判定結果をデスクトップアプリケーションにリアルタイム表示する機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 一人称映像のリアルタイムストリーミング表示
  - AI不良判定結果の即座表示（OK/NG、信頼度スコア）
  - 不良箇所のハイライト表示とヒートマップ
  - 複数ウェアラブルデバイスからの同時映像監視
  - 検査履歴とレポートの一覧表示
  - アラート通知とエスカレーション機能
  - 検査プロセスの統計分析表示

#### **🖐️ F-035: ウェアラブルデバイスでのジェスチャー入力**
- **概要**: 手指/手の動きや頭部の向きなどのジェスチャーを用いて、ウェアラブルデバイスおよび検査アプリをハンズフリーで操作できる機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 基本操作ジェスチャー: 開始/停止、OK/NG確定、次へ/戻る、ズーム/パン、スクリーンマーカー表示切替
  - 検出方式: カメラベースのハンドトラッキング + IMU（加速度/ジャイロ）併用のセンサーフュージョン
  - 誤検知低減: 連続フレーム確認、領域制約、信頼度しきい値、意図確認のためのダブルアクション（例: ホールド+ジェスチャー）
  - 環境対応: 手袋・油汚れ・強照度環境での検出ロバスト性向上設定
  - 学習/キャリブレーション: 個人ごとの利き手、可動域に合わせた簡易キャリブレーション手順
  - フィードバック: ジェスチャー認識時の視覚（UIハイライト）・音声/バイブ通知
  - フォールバック: 音声コマンド（F-032）およびタップ操作への即時切替
  - 管理機能: ジェスチャーマップの割当/無効化、現場ごとのプリセット、監査ログ出力

### **3.10. 録画映像機能**

#### **🔍 F-036: 録画映像の検索機能**
- **概要**: 録画された一人称映像を複数の条件で検索・絞り込みできる機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 製品情報による検索（指図番号・指示番号・型式・機番・月連番）
  - 録画日時範囲による絞り込み
  - 録画者（ユーザー）による絞り込み
  - 検査結果（OK/NG）による絞り込み
  - 不良検出種別による絞り込み（外観不良、寸法不良、機能不良等）
  - タグ・キーワードによる検索
  - 複合条件による詳細検索
  - 検索履歴の保存・呼び出し
  - お気に入り映像の登録・管理
  - 検索結果のソート・ページング表示

#### **🎬 F-037: 録画映像の再生機能**
- **概要**: 検索で見つけた一人称映像を効率的に再生・確認できる機能を提供する
- **優先度**: 🔴 High
- **機能**:
  - 高品質映像再生（4K/60fps対応）
  - 再生速度調整（0.25x〜4.0x、フレーム単位でのコマ送り）
  - タイムライン表示とシーク操作
  - 不良検出箇所の自動ハイライト表示
  - AI検査結果の重畳表示（信頼度スコア、ヒートマップ）
  - 重要シーンのブックマーク機能
  - 映像の部分クリップ作成・共有
  - 全画面表示とピクチャーインピクチャー
  - 音声の有無切り替え
  - 字幕・注釈の表示
  - 複数映像の同期再生（比較用）

#### **📊 F-038: 録画映像の分析・レポート機能**
- **概要**: 録画映像データを統計分析し、品質改善や作業効率向上のための洞察を提供する
- **優先度**: 🟡 Medium
- **機能**:
  - 録画データの統計ダッシュボード（録画時間、件数、容量）
  - 不良検出傾向の分析（時系列、製品別、作業者別）
  - 作業効率分析（作業時間、手順遵守率）
  - 品質トレンド分析（不良率推移、改善効果測定）
  - 定期レポート生成（日次・週次・月次）
  - データエクスポート機能（CSV、PDF）
  - カスタムレポート作成
  - アラート設定（異常値検出時の通知）

## **4. 非機能要件**

### **4.1. 性能・拡張性 (Performance & Scalability)**

#### **⚡ NF-001: スループット**
- **要求**: システムは、単位時間あたりに指定された数のパイプラインを処理できること
- **詳細**: ボトルネックとなっている処理コンポーネントを特定し、個別にスケールアウトできる構成であること
- **測定方法**: 同時実行パイプライン数、平均処理時間

#### **📈 NF-002: スケーラビリティ**
- **要求**: 将来的な処理負荷の増大に対応するため、パイプライン実行サーバー（ワーカーノード）をクラスタに容易に追加できること
- **詳細**: 水平スケーリング対応、自動スケーリング機能
- **測定方法**: ノード追加時間、負荷分散効率

#### **🎯 NF-003: リソースの効率的利用**
- **要求**: 処理の性質に応じて適切なコンピューティングリソースを割り当てられること
- **詳細**: リソース要件に基づく動的リソース割り当て
- **測定方法**: リソース使用率、コスト効率

### **4.2. 可用性・信頼性 (Availability & Reliability)**

#### **🛡️ NF-004: 耐障害性**
- **要求**: 特定の処理コンポーネントで障害が発生しても、その影響が他のコンポーネントやパイプライン全体に波及しないこと
- **詳細**: 障害が発生したコンポーネントは自動的に復旧されること
- **測定方法**: MTTR（平均復旧時間）、障害影響範囲

#### **💾 NF-005: データ永続性**
- **要求**: 入力データ、中間成果物、最終成果物は、システム障害によって失われないこと
- **詳細**: 永続化ストレージへの確実な保存
- **測定方法**: データ損失率、バックアップ復旧時間

### **4.3. 運用・保守性 (Operability & Maintainability)**

#### **👁️ NF-006: 監視**
- **要求**: システムを構成する各コンポーネントのリソース使用率（CPU、メモリ）や、アプリケーション固有のメトリクスを収集し、可視化できること
- **詳細**: ダッシュボード、アラート機能
- **測定方法**: 監視カバレッジ、アラート精度

#### **📝 NF-007: ロギング**
- **要求**: 全ての処理コンポーネントから出力されるログを一元的に収集し、検索・分析できること
- **詳細**: 構造化ログ、ログ保持期間設定
- **測定方法**: ログ検索性能、ログ完全性

#### **🚀 NF-008: デプロイの自動化**
- **要求**: 処理コンポーネントのソースコードが更新された際、自動的にビルドとデプロイが行われるCI/CDパイプラインを構築できること
- **詳細**: 自動化されたビルド・テスト・デプロイプロセス
- **測定方法**: デプロイ時間、自動化率

#### **🗄️ NF-011: 録画データの保存期間**
- **要求**: ウェアラブルデバイスで録画された一人称映像データは1年間保存されること
- **詳細**:
  - ストレージのライフサイクルポリシーにより、1年後にアーカイブまたは削除を自動適用
  - 保存対象: 映像ファイル（MP4等）および付随メタデータ（JSON等）
  - セキュリティ: 保存期間中は暗号化保存とアクセス制御（RBAC）を適用
  - 例外: 法令/監査要件で延長が必要な場合はポリシーで上書き可能
- **測定方法**: ライフサイクル適用率、保存対象の網羅率、ポリシー逸脱件数

### **4.4. セキュリティ (Security)**

#### **🔐 NF-009: アクセス制御**
- **要求**: システムへのアクセスは、適切な認証・認可によって制御されること
- **詳細**: RBAC（Role-Based Access Control）、多要素認証
- **測定方法**: アクセス制御違反数、認証成功率

#### **🔒 NF-010: 機密情報管理**
- **要求**: データベースのパスワードやAPIキーなどの機密情報は、ソースコードにハードコーディングせず、適切な仕組みを用いて安全に管理すること
- **詳細**: 暗号化、Secret管理
- **測定方法**: 機密情報露出リスク評価

### **4.5. モバイル・UX (Mobile & User Experience)**

#### **📱 NF-012: ハンディターミナル端末対応**
- **要求**: 検査用ハンディターミナル端末は厳しい作業環境で長時間安定動作すること
- **詳細**: 
  - バッテリー持続時間: 連続8時間以上の検査業務対応
  - 防塵防水性能: IP65相当の環境耐性
  - 耐衝撃性能: 1.2mからの落下耐性
  - 温度動作範囲: -10℃〜+50℃
  - 手袋操作対応: 厚手の作業用手袋での確実な操作
  - 画面視認性: 直射日光下での高輝度表示（1000nit以上）
  - 物理ボタン応答性: 撮影ボタンの確実な動作（99.5%以上の成功率）
- **測定方法**: バッテリー持続時間、環境耐性テスト、操作成功率、画面輝度測定

#### **📱 NF-013: モバイル対応**
- **要求**: 検査アプリは様々なモバイルデバイス（スマートフォン、タブレット、ハンディターミナル）で安定動作すること
- **詳細**: iOS/Android対応、画面サイズ適応、バッテリー効率性
- **測定方法**: デバイス互換性、バッテリー持続時間、UI応答性

#### **⌚ NF-017: ウェアラブルデバイス対応**
- **要求**: THINKLETなどのウェアラブルデバイスで長時間安定動作すること
- **詳細**: 
  - バッテリー持続時間: 連続8時間以上の動作
  - 軽量設計: 約170gの重量制約内での最適化
  - 防塵防水: IP5X/IPX4相当の環境耐性
  - 高温環境: 工場・現場環境での動作保証
- **測定方法**: バッテリー消費量、動作安定性、環境耐性テスト

#### **🔌 NF-014: オフライン対応**
- **要求**: ネットワーク接続が不安定な現場環境でも検査業務が継続できること
- **達成手段**: 「単一路インジェスト＋サーバ分岐＋切断/復帰機構」に基づき、端末側は録画セグメントの状態機械（LOCAL/UPLOADING/SYNCED/FAILED）とリングバッファ、マルチパート再開（ETag照合）、指数バックオフ、ネットワーク別同時アップロード本数（LTE:1–2、Wi‑Fi:4–6）を実装。オフライン時も録画継続・軽量ローカルAIで最低限判定、復帰時は重要度別優先同期と差分転送を行う。
- **測定方法（成功指標）**: 
  - 復帰後の同期完了時間（P50/P95）
  - 同期成功率/競合解決率
  - データ整合性（欠損/重複ゼロ）

#### **🎯 NF-015: UI/UX要件**
- **要求**: 現場作業者が手袋をしたまま操作できる直感的なインターフェースであること
- **詳細**: 大きなタップターゲット、音声フィードバック、シンプルな操作フロー
- **測定方法**: ユーザビリティテストスコア、操作エラー率、作業効率向上率

#### **🎥 NF-018: リアルタイム映像処理性能**
- **要求**: ウェアラブルデバイスからの映像ストリームを低遅延で処理できること
- **達成手段**: デバイス→サーバはWHEP/WebRTC（代替:RTSP）による「単一路インジェスト」とし、サーバ側でA) リアルタイムAI処理、B) サーバ録画/アーカイブ、C) 配信（WebRTC/HTTP HLS等）に分岐。デバイス→サーバのgRPCは制御・メタデータ・軽量イベントに限定し、AI向けフレーム抽出はサーバ側で行い、サーバ内（またはサーバ→AIワーカー間）をgRPCストリーミングとする。
- **詳細**: 
  - エンドツーエンド映像遅延（単一路化後）: <20ms（WHEP/WebRTC）
  - フレームレート: 30fps安定動作
  - 解像度: 8MP（水平120度×垂直90度視野角）対応
  - 同時接続: 複数デバイス並列
- **測定方法（成功指標）**: 
  - E2E遅延（P50/P95）
  - フレームドロップ率
  - サーバ分岐の処理遅延（AI/録画/配信別）

#### **🎙️ NF-019: 音声処理性能**
- **要求**: ウェアラブルデバイスの高性能マイクを活用した音声処理が安定動作すること
- **詳細**:
  - 音声品質: 48kHz/24bit相当の高品質録音
  - 騒音抑制: 80dB以上の環境騒音下での音声認識
  - 応答性: 音声コマンド認識遅延<500ms
  - 多言語対応: 日本語・英語の音声認識精度>95%
- **測定方法**: 音声認識精度、応答時間、騒音環境テスト

#### **🖐️ NF-020: ジェスチャー処理性能**
- **要求**: 現場環境下でジェスチャー入力が低遅延・高精度で動作すること
- **詳細**:
  - 認識遅延: エンドツーエンド<200ms（デバイス/ネットワーク条件下）
  - 認識精度: 主要ジェスチャーのF1スコア>0.95（標準環境）、>0.90（手袋/強照度/背景雑音環境）
  - ロバスト性: 手袋着用、部分遮蔽、逆光、反射面での安定動作
  - リソース: 常時実行時のCPU/GPU/バッテリー消費を許容範囲内に制御（NF-016と整合）
- **測定方法**: 遅延計測、混同行列に基づく精度評価、ベンチマークシナリオでの連続稼働試験

### **4.6. 移行性 (Portability)**

#### **☁️ NF-016: クラウド非依存**
- **要求**: システムはオープンソースの技術を主軸とし、特定のクラウドベンダーの独自サービスへの依存を最小限に抑えること
- **詳細**: 将来的なオンプレミス環境や他クラウドへの移行が容易であること
- **測定方法**: ベンダーロックイン度、移行工数

## **5. その他**

### **5.1. 用語集**

| 英語 / 日本語                                          | 説明                                                                       |
| :----------------------------------------------------- | :------------------------------------------------------------------------- |
| **Pipeline / パイプライン**                            | 画像処理の各ステップ（リサイズ、AI処理など）を連結した処理フロー           |
| **Component / コンポーネント**                         | 独立した画像処理機能を実装した処理単位。パイプラインの構成要素となる       |
| **Execution / 実行**                                   | 定義されたパイプラインを実際に動作させること                               |
| **Node / ノード**                                      | 処理を実行するコンピューティングリソースの単位                             |
| **Pod / ポッド**                                       | コンテナの集合体。1つ以上のコンテナが協調して動作する単位                  |
| **Real-time Processing / リアルタイム処理**            | 低遅延での画像処理を要求される処理形態                                     |
| **Batch Processing / バッチ処理**                      | 大量データを一括で処理する処理形態                                         |
| **DAG / 有向非巡回グラフ**                             | パイプラインの処理フローを表現するデータ構造                               |
| **Streaming / ストリーミング**                         | 連続的なデータフローでの処理方式                                           |
| **Scalability / スケーラビリティ**                     | システムの拡張性。負荷増加に対応してリソースを追加できる能力               |
| **Monitoring / 監視**                                  | システムの状態やパフォーマンスを継続的に観測すること                       |
| **Authentication / 認証**                              | ユーザーやシステムの身元を確認すること                                     |
| **Authorization / 認可**                               | 認証されたユーザーに対してアクセス権限を付与すること                       |
| **Inspection Master / 検査マスタ**                     | 検査指示の製品・部品情報と検査項目を定義したマスタデータ                   |
| **Mobile Inspection App / モバイル検査アプリ**         | 現場作業者が使用する検査業務専用のモバイルアプリケーション                 |
| **Handy Terminal Inspection / ハンディターミナル検査** | ハンディターミナルを使用した現場検査業務。物理ボタン操作による簡単操作     |
| **Physical Button / 物理ボタン**                       | ハンディターミナルに搭載された撮影用の物理的なボタン。厚手手袋でも操作可能 |
| **AI Inspection / AI検査**                             | 人工知能技術を用いた画像解析による自動検査                                 |
| **Visual Inspection / 外観検査**                       | 製品の表面状態や外観品質を確認する検査                                     |
| **Quality Control / 品質管理**                         | 製品の品質を維持・向上させるための管理活動                                 |
| **Traceability / トレーサビリティ**                    | 製品の履歴や検査結果を追跡可能にする仕組み                                 |
| **Offline Sync / オフライン同期**                      | ネットワーク未接続時のデータ保存と接続回復時の自動同期                     |
| **QR Code / QRコード**                                 | 検査指示を識別するための二次元バーコード                                   |
| **THINKLET / シンクレット**                            | Fairy Devicesが開発したウェアラブルデバイス。一人称映像と音声機能搭載      |
| **First-Person Video / 一人称映像**                    | ウェアラブルデバイスによる装着者視点での映像撮影                           |
| **Wearable Device / ウェアラブルデバイス**             | 身に着けて使用する電子機器。カメラやマイク、センサーを搭載                 |
| **Voice Command / 音声コマンド**                       | 音声入力による機器操作や指示の実行                                         |
| **Real-time Inspection / リアルタイム検査**            | 映像ストリームをリアルタイムで解析し即座に品質判定を行う検査               |
| **XFE Technology / XFE技術**                           | 環境騒音を抑制し目的の音声を明瞭に集音する音声処理技術                     |
| **Gesture Input / ジェスチャー入力**                   | 手指/手/頭部の動きによる非接触操作。ハンドトラッキングやIMUで検出          |
| **IMU / 慣性計測ユニット**                             | 加速度計・ジャイロ等からなる姿勢/動き検出センサー                          |
| **Hand Tracking / ハンドトラッキング**                 | カメラ映像から手指の位置・形状を推定しジェスチャーを認識する技術           |

### **5.2. 制約事項**

#### **技術的制約**
- 処理コンポーネントはコンテナ化されている必要がある
- 画像データは標準的なフォーマット（JPEG、PNG、TIFF等）に対応する
- パイプライン定義は構造化された形式（JSON/YAML）で記述される
- モバイルアプリはiOS 12.0以上、Android 8.0以上に対応する
- 検査用カメラは最低800万画素以上の解像度が必要
- ハンディターミナル端末は産業用グレード（IP65相当の防塵防水性能）が必要
- ハンディターミナル端末の物理撮影ボタンは厚手手袋での操作に対応する必要がある
- ハンディターミナル端末は連続8時間以上の動作バッテリーを搭載する必要がある
- ウェアラブルデバイス（THINKLET）はFairy OS（AOSPベース）で動作する
- ウェアラブルデバイスアプリはAndroid SDK互換性が必要
- 音声処理にはXFEライブラリのライセンスが必要（オプション機能）

#### **運用制約**  
- システムの稼働時間は24時間365日を想定する
- 定期メンテナンス時間は事前に通知される
- データ保持期間は運用ポリシーに従って設定される
- 録画データ（ウェアラブル一人称映像）は1年間保存する（ライフサイクルポリシーで管理、法令等により延長可）
- 検査データは法的要件に応じて長期保存される
- オフライン環境での検査業務継続性を考慮する
- ハンディターミナル端末は工場・現場環境での耐久性運用を前提とする
- ハンディターミナル端末のバッテリー交換・充電スケジュールは運用計画に含める

#### **セキュリティ制約**
- 機密データは暗号化して保存される
- アクセスログは監査要件に従って保持される
- 外部システムとの通信は暗号化される
- 検査結果の改ざん防止機能が実装される
- 個人情報（検査者情報等）は適切に保護される
