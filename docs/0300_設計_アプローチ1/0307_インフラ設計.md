# ImageFlowCanvas ã‚¤ãƒ³ãƒ•ãƒ©è¨­è¨ˆæ›¸

## **æ–‡æ›¸ç®¡ç†æƒ…å ±**

| é …ç›®       | å†…å®¹                           |
| ---------- | ------------------------------ |
| æ–‡æ›¸å     | ImageFlowCanvas ã‚¤ãƒ³ãƒ•ãƒ©è¨­è¨ˆæ›¸ |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | 1.1                            |
| ä½œæˆæ—¥     | 2025å¹´7æœˆ12æ—¥                  |
| æ›´æ–°æ—¥     | 2025å¹´8æœˆ11æ—¥                  |


---

## **8. ã‚¤ãƒ³ãƒ•ãƒ©è¨­è¨ˆ**

### **8.0. ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å ´æ‰€ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆ¦ç•¥**

#### **8.0.1. VM0: ã‚¨ãƒƒã‚¸ãƒ»ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚µãƒ¼ãƒãƒ¼ (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å±¤)**

| ğŸ”§ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ  | ğŸ“ æ¨å¥¨ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å ´æ‰€                                                   | âš™ï¸ ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•                        | ğŸ¯ ç”¨é€”ãƒ»ç‰¹å¾´                                                  |
| :---------------- | :----------------------------------------------------------------------- | :------------------------------------ | :------------------------------------------------------------ |
| **ğŸšª API Gateway** | AWS ALB/CloudFlare<br/>ã¾ãŸã¯<br/>ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ nginx                     | Docker Compose<br/>Kubernetes Ingress | â€¢ SSLçµ‚ç«¯ãƒ»èªè¨¼<br/>â€¢ è² è·åˆ†æ•£<br/>â€¢ ãƒ¬ãƒ¼ãƒˆåˆ¶é™               |
| **ğŸ”§ Backend API** | AWS ECS/GKE<br/>ã¾ãŸã¯<br/>ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ Docker                           | FastAPI Container                     | â€¢ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯<br/>â€¢ Kafka Producer<br/>â€¢ WebSocketç®¡ç†   |
| **ğŸŒ Web UI**      | AWS S3+CloudFront<br/>Azure Static Web Apps<br/>ã¾ãŸã¯<br/>nginxé™çš„é…ä¿¡ | React Build<br/>CDNé…ä¿¡               | â€¢ SPA (Single Page App)<br/>â€¢ é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡<br/>â€¢ ç®¡ç†ç”»é¢ |

#### **8.0.2. VM1: å°‚ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼ (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°å±¤)**

| ğŸ”§ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ    | ğŸ“ æ¨å¥¨ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å ´æ‰€                           | âš™ï¸ ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•                      | ğŸ¯ ç”¨é€”ãƒ»ç‰¹å¾´                                                         |
| :------------------ | :----------------------------------------------- | :---------------------------------- | :------------------------------------------------------------------- |
| **ğŸ“¨ Apache Kafka**  | å°‚ç”¨ç‰©ç†ã‚µãƒ¼ãƒãƒ¼<br/>AWS MSK<br/>Confluent Cloud | Kafka Cluster<br/>(3ãƒãƒ¼ãƒ‰æ§‹æˆæ¨å¥¨) | â€¢ é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ<br/>â€¢ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ°¸ç¶šåŒ–<br/>â€¢ ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ä¸¦åˆ—å‡¦ç† |
| **ğŸ”— Kafka Connect** | KafkaåŒå±…ã‚µãƒ¼ãƒãƒ¼                                | Docker Container                    | â€¢ MinIOé€£æº<br/>â€¢ ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†<br/>â€¢ ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³            |

#### **8.0.3. VM2: é«˜æ€§èƒ½ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼ (å‡¦ç†å®Ÿè¡Œå±¤)**

| ğŸ”§ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ         | ğŸ“ æ¨å¥¨ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å ´æ‰€                                       | âš™ï¸ ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•        | ğŸ¯ ç”¨é€”ãƒ»ç‰¹å¾´                                                     |
| :----------------------- | :----------------------------------------------------------- | :-------------------- | :--------------------------------------------------------------- |
| **â˜¸ï¸ K3s Cluster**        | GPUæ­è¼‰ç‰©ç†ã‚µãƒ¼ãƒãƒ¼<br/>AWS EC2 G4/P3<br/>GCP Compute Engine | K3s Multi-node        | â€¢ GPU/CPUæ··åœ¨ç’°å¢ƒ<br/>â€¢ è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°<br/>â€¢ ãƒªã‚½ãƒ¼ã‚¹åŠ¹ç‡åŒ–    |
| **âš¡ gRPCå¸¸é§ã‚µãƒ¼ãƒ“ã‚¹ç¾¤** | K3så†…éƒ¨                                                      | Kubernetes Deployment | â€¢ ç›´æ¥gRPCå‘¼ã³å‡ºã—<br/>â€¢ è¶…é«˜é€Ÿå‡¦ç†<br/>â€¢ å‹•çš„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åˆ¶å¾¡   |
| **ğŸ’¾ MinIO**              | é«˜é€ŸSSD/NVMeã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸                                       | K3s StatefulSet       | â€¢ ç”»åƒãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–<br/>â€¢ S3äº’æ›API<br/>â€¢ é«˜IOPSã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸        |
| **ğŸ³ å‡¦ç†Podç¾¤**          | GPU/CPUãƒãƒ¼ãƒ‰                                                | Kubernetes Deployment | â€¢ ç”»åƒå‡¦ç†å®Ÿè¡Œ<br/>â€¢ å‹•çš„ãƒªã‚½ãƒ¼ã‚¹å‰²ã‚Šå½“ã¦<br/>â€¢ æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° |

#### **8.0.4. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**

```mermaid
graph TD
    Internet["ğŸŒ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ"]
    
    subgraph CloudEdge["â˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰/ã‚¨ãƒƒã‚¸ (VM0)"]
        LB["âš–ï¸ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼<br/>â€¢ SSLçµ‚ç«¯<br/>â€¢ DDoSä¿è­·"]
        WAF["ğŸ›¡ï¸ WAF<br/>â€¢ Web Application Firewall"]
        APIGWHost["ğŸšª API Gateway<br/>â€¢ èªè¨¼ãƒ»èªå¯<br/>â€¢ ãƒ¬ãƒ¼ãƒˆåˆ¶é™"]
        BackendHost["ğŸ”§ Backend API<br/>â€¢ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†"]
        WebUIHost["ğŸŒ Web UI<br/>â€¢ é™çš„é…ä¿¡ãƒ»CDN"]
    end
    
    subgraph PrivateNetwork["ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯"]
        subgraph MessageLayer["VM1: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°å±¤"]
            KafkaHost["ğŸ“¨ Kafka Cluster<br/>â€¢ 3ãƒãƒ¼ãƒ‰æ§‹æˆ<br/>â€¢ ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³"]
        end
        
        subgraph ProcessingLayer["VM2: å‡¦ç†å®Ÿè¡Œå±¤"]
            K3sHost["â˜¸ï¸ K3s Cluster<br/>â€¢ ãƒã‚¹ã‚¿ãƒ¼ + ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒ‰<br/>â€¢ GPU/CPUæ··åœ¨"]
        end
    end
    
    Internet --> LB
    LB --> WAF
    WAF --> APIGWHost
    APIGWHost --> BackendHost
    APIGWHost --> WebUIHost
    
    BackendHost -.->|"VPN/å°‚ç”¨ç·š"| KafkaHost
    KafkaHost -.->|"å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯"| K3sHost
```

#### **8.0.5. ãƒªã‚½ãƒ¼ã‚¹è¦ä»¶ã¨æ¨å¥¨ã‚¹ãƒšãƒƒã‚¯**

| ğŸ–¥ï¸ ã‚µãƒ¼ãƒãƒ¼       | ğŸ’» æ¨å¥¨ã‚¹ãƒšãƒƒã‚¯        | ğŸ’¾ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | ğŸ’° æ¨å®šã‚³ã‚¹ãƒˆ/æœˆ |
| :--------------- | :-------------------- | :----------- | :------------- | :-------------- |
| **VM0 (ã‚¨ãƒƒã‚¸)** | 4vCPU, 8GB RAM        | 100GB SSD    | 1Gbps          | $100-200        |
| **VM1 (Kafka)**  | 8vCPU, 16GB RAM       | 500GB SSD    | 10Gbps         | $200-400        |
| **VM2 (K3s)**    | 16vCPU, 64GB RAM, GPU | 1TB NVMe SSD | 10Gbps         | $800-1500       |

#### **8.0.6. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆ¦ç•¥**

1. **æ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤**: VM0 â†’ VM1 â†’ VM2ã®é †åºã§ãƒ‡ãƒ—ãƒ­ã‚¤
2. **Blue-Green ãƒ‡ãƒ—ãƒ­ã‚¤**: æœ¬ç•ªç’°å¢ƒã§ã®ã‚¼ãƒ­ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ æ›´æ–°
3. **ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹**: æ–°æ©Ÿèƒ½ã®æ®µéšçš„å±•é–‹
4. **GitOps**: Git ãƒªãƒã‚¸ãƒˆãƒªã‚’çœŸå®Ÿã®æºã¨ã—ãŸè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

### **8.1. Kubernetesã‚¯ãƒ©ã‚¹ã‚¿è¨­è¨ˆ**

#### **8.1.1. ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆ**

```yaml
# K3s ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆ
cluster:
  name: imageflow-k3s
  version: v1.28.9+k3s1
  
  master_nodes:
    - name: k3s-master-01
      ip: 10.0.1.10
      resources:
        cpu: 4
        memory: 8Gi
        storage: 100Gi
  
  worker_nodes:
    - name: k3s-worker-01
      ip: 10.0.1.11
      resources:
        cpu: 8
        memory: 16Gi
        storage: 500Gi
      labels:
        node-type: cpu-intensive
        
    - name: k3s-worker-02
      ip: 10.0.1.12
      resources:
        cpu: 8
        memory: 32Gi
        gpu: 1
        storage: 1Ti
      labels:
        node-type: gpu-enabled
        
    - name: k3s-worker-03
      ip: 10.0.1.13
      resources:
        cpu: 4
        memory: 8Gi
        storage: 2Ti
      labels:
        node-type: storage-optimized
```

#### **8.1.2. Namespaceè¨­è¨ˆ**

```yaml
# Namespaceæ§‹æˆ
namespaces:
  - name: imageflow-web
    purpose: Web UI, API Gateway
    
  - name: imageflow-backend
    purpose: Backend API Services
    
  - name: imageflow-processing
    purpose: gRPC Processing Services
    
  - name: imageflow-storage
    purpose: MinIO, Database
    
  - name: imageflow-monitoring
    purpose: Prometheus, Grafana
```

---

### **8.1.3. ç¾å ´ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­è¨ˆï¼ˆå°å‹APï¼‹æœ‰ç·šãƒãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ï¼‰**

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã®ç¾å ´ï¼ˆå·¥å ´ãƒ»ãƒ©ã‚¤ãƒ³ï¼‰ã«ãŠã‘ã‚‹ç„¡ç·šæ–¹å¼ã¯ã€ã€Œå°å‹APï¼ˆ5GHz/20MHz/éDFS/ä½å‡ºåŠ›ï¼‰ï¼‹æœ‰ç·šãƒãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã€ã«çµ±ä¸€ã™ã‚‹ã€‚ç«¯æœ«å¢—åŠ ã‚„ç§»å‹•æ™‚ã®é›»æ³¢å¹²æ¸‰ãƒ»ãƒ­ãƒ¼ãƒŸãƒ³ã‚°èª²é¡Œã‚’ã€è¨­è¨ˆã¨é‹ç”¨ã§å®‰å®šçš„ã«è§£æ±ºã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚

#### 8.1.3.1 é‹ç”¨ãƒãƒªã‚·ãƒ¼
- å‘¨æ³¢æ•°/å¸¯åŸŸå¹…: 5GHzå›ºå®šãƒ»20MHzãƒãƒ£ãƒãƒ«å¹…ãƒ»éDFSãƒãƒ£ãƒãƒ«
- é›»åŠ›è¨­è¨ˆ: ä½å‡ºåŠ›ï¼ˆå°ã‚»ãƒ«åŒ–ï¼‰ã§ã‚»ãƒ«å¢ƒç•Œã‚’æ˜ç¢ºåŒ–
- ãƒãƒƒã‚¯ãƒ›ãƒ¼ãƒ«: ã™ã¹ã¦æœ‰ç·šï¼ˆã‚®ã‚¬ãƒ“ãƒƒãƒˆä»¥ä¸Šã€PoEæ¨å¥¨ï¼‰
- SSIDè¨­è¨ˆ: å…¨APã§å…±é€šSSID/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’çµ±ä¸€
- é‹ç”¨: ãƒãƒ£ãƒãƒ«è¨ˆç”»ãƒ»å‡ºåŠ›ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒ­ãƒ¼ãƒŸãƒ³ã‚°æœ€é©åŒ–ï¼ˆè¨­è¨ˆã§å¸åï¼‰

#### 8.1.3.2 è¦æ¨¡åˆ¥è¨­è¨ˆã®ç›®å®‰
| ç«¯æœ«æ•°  | å°å‹APã‚»ãƒ«è¨­è¨ˆ                           | å‚™è€ƒ                            |
| ------- | ---------------------------------------- | ------------------------------- |
| 1å°     | å˜ä¸€ã‚»ãƒ«ã§ååˆ†                           | å¹²æ¸‰å°‘ã€æœ€å°æ§‹æˆ                |
| 2-4å°   | 2-3ã‚»ãƒ«ã«åˆ†å‰²ã€ãƒãƒ£ãƒãƒ«å›ºå®š              | 20MHzå¹…ã§åŒæ™‚é€šä¿¡ã®å®‰å®šç¢ºä¿     |
| 5å°ä»¥ä¸Š | å°ã‚»ãƒ«å¤šæ•°ï¼‹æœ‰ç·šBHã€åŒä¸€SSIDã§ãƒ­ãƒ¼ãƒŸãƒ³ã‚° | ã‚»ãƒ«å†åˆ©ç”¨ã§é¢ç©/å°æ•°ã«ç·šå½¢å¯¾å¿œ |

#### 8.1.3.3 ã‚³ã‚¹ãƒˆãƒ»é‹ç”¨æ¯”è¼ƒï¼ˆå‚è€ƒï¼‰

| æ–¹å¼                             | åˆæœŸæŠ•è³‡                             | æ‹¡å¼µæ€§                          | å¹²æ¸‰/æ··ç·šå¯¾ç­–                            | ãƒ­ãƒ¼ãƒŸãƒ³ã‚°                         | é‹ç”¨ãƒ»ä¿å®ˆ                | ä¸»ãªãƒªã‚¹ã‚¯/è£œè¶³                                | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶                           | å°å…¥æœŸé–“                     | ç·ä¿æœ‰ã‚³ã‚¹ãƒˆï¼ˆTCOï¼‰                            |
| -------------------------------- | ------------------------------------ | ------------------------------- | ---------------------------------------- | ---------------------------------- | ------------------------- | ---------------------------------------------- | ------------------------------------------ | ---------------------------- | ---------------------------------------------- |
| å°å‹APï¼‹æœ‰ç·šãƒãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ï¼ˆæ¨å¥¨ï¼‰ | ä½ã€œä¸­ï¼ˆå°å‹AP/PoEã‚¹ã‚¤ãƒƒãƒæ®µéšå°å…¥ï¼‰ | é«˜ï¼ˆã‚»ãƒ«è¿½åŠ ã§é¢ç©/å°æ•°ã«ç·šå½¢ï¼‰ | éDFS/20MHz/ä½å‡ºåŠ›ï¼‹ãƒãƒ£ãƒãƒ«è¨ˆç”»ã§æŠ‘åˆ¶   | è‰¯ï¼ˆåŒä¸€SSIDã€802.11k/v/rå¯¾å¿œæ™‚â—ï¼‰ | ä¸€å…ƒç®¡ç†ãƒ»ç›£è¦–ãŒå®¹æ˜“      | ç¾åœ°ã‚µã‚¤ãƒˆã‚µãƒ¼ãƒ™ã‚¤/å‡ºåŠ›èª¿æ•´ãŒå¿…è¦              | ä¸­ã€œé«˜ï¼ˆWPA2/WPA3ã€VLAN/802.1Xã§é«˜æ°´æº–å¯ï¼‰ | çŸ­ã€œä¸­ï¼ˆç¾åœ°èª¿æŸ»ãƒ»é…ç·šå«ã‚€ï¼‰ | ä½ã€œä¸­ï¼ˆæ®µéšæŠ•è³‡ãƒ»é‹ç”¨å®¹æ˜“ã§æŠ‘åˆ¶ï¼‰             |
| ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºAPé›†ä¸­è¨­è¨ˆ       | ä¸­ã€œé«˜ï¼ˆé«˜æ€§èƒ½AP/ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©å°å…¥ï¼‰  | ä¸­ï¼ˆé«˜å¯†åº¦ã§ã¯ã‚»ãƒ«è¨­è¨ˆãŒå‰æï¼‰  | å¤§å‡ºåŠ›ã¯ã‚»ãƒ«è‚¥å¤§ã§å¹²æ¸‰å¢—ã®æ‡¸å¿µã€è¨­è¨ˆæ¬¡ç¬¬ | ä¸­ï¼ˆæ©Ÿç¨®/è¨­å®šä¾å­˜ï¼‰                | å°‚ä»»ã‚¹ã‚­ãƒ«/ä¿å®ˆå¥‘ç´„ãŒå‰æ | é‡‘å±åå°„/DFSåˆ¶ç´„ã€è²»ç”¨å¯¾åŠ¹æœãŒç’°å¢ƒä¾å­˜         | é«˜ï¼ˆ802.1X/RADIUSã€NACã€é›†ä¸­ç®¡ç†ï¼‰         | ä¸­ï¼ˆè¨­è¨ˆ/èª¿æ•´/ãƒ™ãƒ³ãƒ€èª¿æ•´ï¼‰   | ä¸­ã€œé«˜ï¼ˆä¿å®ˆãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ»å°‚ä»»è¦å“¡ãŒå‰æï¼‰     |
| SoftAPï¼ˆPC/ç«¯æœ«APåŒ–ï¼‰            | ä½ï¼ˆæ—¢å­˜æ©Ÿå™¨ã§é–‹å§‹å¯ï¼‰               | ä½ï¼ˆåŒæ™‚æ¥ç¶š/å®‰å®šæ€§ã«é™ç•Œï¼‰     | ä½ï¼ˆç«¯æœ«APä¹±ç«‹ã§å¹²æ¸‰ã—ã‚„ã™ã„ï¼‰           | ãªã—ï¼ˆåŸºæœ¬å›ºå®šæ¥ç¶šï¼‰               | ç«¯æœ«å€‹åˆ¥è¨­å®šã§é‹ç”¨è² è·é«˜  | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/é›»æ³¢å®‰å®šæ€§/çœé›»åŠ›ã«èª²é¡Œ           | ä½ï¼ˆPSKä¸­å¿ƒã€ç«¯æœ«è¨­å®šä¾å­˜ãƒ»çµ±åˆ¶å›°é›£ï¼‰      | çŸ­ï¼ˆå³æ—¥é–‹å§‹å¯ï¼‰             | ä½ï¼ˆåˆæœŸä½ã‚³ã‚¹ãƒˆã ãŒé‹ç”¨è² è·ã§éš ã‚Œã‚³ã‚¹ãƒˆç™ºç”Ÿï¼‰ |
| ãƒ­ãƒ¼ã‚«ãƒ«5Gï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ5Gï¼‰     | éå¸¸ã«é«˜ï¼ˆå…è¨±/è¨­å‚™/è¨­è¨ˆ/ç«¯æœ«èª¿é”ï¼‰  | é«˜ï¼ˆå¤§è¦æ¨¡/å°‚ç”¨å¸¯åŸŸã§æ‹¡å¼µå®¹æ˜“ï¼‰ | éå¸¸ã«é«˜ï¼ˆå°‚ç”¨å¸¯åŸŸã§å¹²æ¸‰å°‘ï¼‰             | è‰¯ï¼ˆåŸºåœ°å±€è¨­è¨ˆæ¬¡ç¬¬ï¼‰               | é«˜ï¼ˆå°‚é–€è¦å“¡/ç¶­æŒè²»ãŒå¤§ï¼‰ | å°å…¥æœŸé–“é•·/ç«¯æœ«ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ /ç¶™ç¶šã‚³ã‚¹ãƒˆãŒå¤§ãã„ | éå¸¸ã«é«˜ï¼ˆSIM/eSIMã€é–‰åŸŸã€å³æ ¼ãªç«¯æœ«èªè¨¼ï¼‰ | é•·ï¼ˆå…è¨±å–å¾—ã€œæœ¬è¨­ã¾ã§ï¼‰     | éå¸¸ã«é«˜ï¼ˆè¨­å‚™ç¶­æŒãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ»äººä»¶è²»ï¼‰       |
| Wiâ€‘Fi Directãƒ–ãƒªãƒƒã‚¸æ–¹å¼         | ä½ã€œä¸­ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—PCè¿½åŠ /è¨­å®šï¼‰    | ä½ã€œä¸­ï¼ˆPCå°æ•°/æ¥ç¶šä¸Šé™ã«ä¾å­˜ï¼‰ | ä½ï¼ˆP2Pæ··åœ¨ã§æŠ‘åˆ¶å›°é›£ï¼‰                  | æ‚ªï¼ˆåˆ‡æ–­â†’å†æ¥ç¶šãŒå‰æï¼‰            | PC/ãƒ‰ãƒ©ã‚¤ãƒç®¡ç†ã®é‹ç”¨è² è· | åˆ‡æ›¿é…å»¶/å®‰å®šæ€§èª²é¡Œã€å°æ•°å¢—ã§è¤‡é›‘æ€§/è² è·ãŒå¢—å¤§ | ä½ã€œä¸­ï¼ˆP2Pä¸­å¿ƒã€çµŒè·¯çµ±åˆ¶/ç›£è¦–ãŒå¼±ã„ï¼‰     | çŸ­ï¼ˆPCè¨­å®šã§å°å…¥ï¼‰           | ä¸­ï¼ˆå°æ•°å¢—ã§é‹ç”¨è² è·ãƒ»éšœå®³å¯¾å¿œã‚³ã‚¹ãƒˆãŒå¢—å¤§ï¼‰   |

#### 8.1.3.4 æƒ³å®šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆ
```mermaid
graph LR
    subgraph ç¾å ´ç«¯æœ«
        HT1[ãƒãƒ³ãƒ‡ã‚£1]
        HT2[ãƒãƒ³ãƒ‡ã‚£2]
        TH1[THINKLET1]
    end

    subgraph å°å‹APã‚»ãƒ«
        AP1[APï¼ˆ5GHz/20MHz/éDFS/ä½å‡ºåŠ›ï¼‰]
        AP2[APï¼ˆ5GHz/20MHz/éDFS/ä½å‡ºåŠ›ï¼‰]
    end

    subgraph ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
        SW[PoEã‚¹ã‚¤ãƒƒãƒ/æœ‰ç·šãƒãƒƒã‚¯ãƒ›ãƒ¼ãƒ«]
        SVR[ã‚µãƒ¼ãƒãƒ¼]
        DT[ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—]
    end

    HT1 -. Wi-Fi(AP) .-> AP1
    HT2 -. Wi-Fi(AP) .-> AP2
    TH1 -. Wi-Fi(AP) .-> AP1
    AP1 --- SW
    AP2 --- SW
    DT --- SW
    SW --- SVR
```

#### 8.1.3.5 ãƒ­ãƒ¼ãƒŸãƒ³ã‚°ãƒ»å¹²æ¸‰å¯¾ç­–ï¼ˆè¨­è¨ˆæŒ‡é‡ï¼‰
- ãƒãƒ£ãƒãƒ«è¨ˆç”»: 2.4GHzã¯åŸå‰‡ä¸ä½¿ç”¨ã€5GHzã®éDFSï¼ˆ36/40/44/48, 149/153/157/161ï¼‰ã‚’å›ºå®šå‰²å½“
- å‡ºåŠ›æœ€é©åŒ–: ã‚»ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã¯âˆ’65ã€œâˆ’70 dBmç¨‹åº¦ã§åæŸã™ã‚‹ã‚ˆã†ä½å‡ºåŠ›é‹ç”¨
- ãƒ­ãƒ¼ãƒŸãƒ³ã‚°èª˜å°: æœ€ä½æ¥ç¶šRSSIï¼ˆä¾‹: âˆ’70 dBmï¼‰ã‚’é–¾å€¤ã«ç«¯æœ«å´ã§å†æ¢ç´¢ã€åŒä¸€SSIDã§åˆ‡æ›¿
- æ©Ÿèƒ½æ´»ç”¨ï¼ˆå¯¾å¿œæ™‚ï¼‰: 802.11k/v/r, band steering, minimum RSSI enforce
- ã‚¢ãƒ—ãƒªå´å¸å: ä¸€æ™‚çš„ãªé›»æ³¢åŠ£åŒ–æ™‚ã¯é€ä¿¡ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã¨å†é€ã€ç¶™ç¶šã‚»ãƒƒã‚·ãƒ§ãƒ³ã§UXç¶­æŒ

#### 8.1.3.6 é‹ç”¨æ‰‹é †ï¼ˆæ¥ç¶šãƒ»ãƒ­ãƒ¼ãƒŸãƒ³ã‚°ï¼‰
1. SSID/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çµ±ä¸€ï¼ˆWPA2/WPA3ã€å¯èƒ½ãªã‚‰Enterpriseï¼‰
2. éDFSãƒãƒ£ãƒãƒ«å›ºå®šï¼ˆ5GHzã€20MHzå¹…ï¼‰
3. ä½å‡ºåŠ›è¨­å®šã§å°ã‚»ãƒ«åŒ–ï¼ˆã‚»ãƒ«å¢ƒç•Œã§âˆ’65ã€œâˆ’70 dBmï¼‰
4. ç«¯æœ«ã¯åŒä¸€SSIDã¸æ¥ç¶šã—ã€æœ€ä½RSSIé–¾å€¤ã‚’ä¸‹å›ã£ãŸã‚‰å†æ¢ç´¢
5. æœ‰ç·šãƒãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ï¼ˆPoE/GbEï¼‰ã§ã‚µãƒ¼ãƒãƒ¼ãƒ»ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã¨æ¥ç¶š

ãƒ­ãƒ¼ãƒŸãƒ³ã‚°æ™‚ã®å‡¦ç†
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¶­æŒ: åŒä¸€SSIDï¼‹ã‚¢ãƒ—ãƒªå±¤ã®å†é€/ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã§UXç¶­æŒ
- åˆ‡æ›¿æ™‚é–“ã®æœ€å°åŒ–: ç«¯æœ«/APãŒå¯¾å¿œã™ã‚‹å ´åˆã¯ 802.11k/v/r ã‚’æœ‰åŠ¹åŒ–
- ãƒ‡ãƒ¼ã‚¿ä¿è­·: ä¸€æ™‚ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã¨å†è©¦è¡Œãƒãƒªã‚·ãƒ¼
- è‡ªå‹•å¾©æ—§: RSSIå›å¾©ãƒ»å†æ¥ç¶šæ™‚ã«æœªé€ä¿¡ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡

#### 8.1.3.7 æ®µéšçš„å°å…¥ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
| ãƒ•ã‚§ãƒ¼ã‚º | å®Ÿè£…å†…å®¹                          | åŠ¹æœ                               |
| -------- | --------------------------------- | ---------------------------------- |
| 1        | å˜ä¸€APã§è©¦é¨“å°å…¥                  | åŸºæœ¬é€šä¿¡/ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã®å®Ÿæ¸¬ç¢ºèª    |
| 2        | 2-3ã‚»ãƒ«åˆ†å‰²ï¼‹ãƒãƒ£ãƒãƒ«å›ºå®š         | åŒæ™‚æ¥ç¶šæ™‚ã®å¹²æ¸‰ä½æ¸›ãƒ»å®‰å®šåŒ–       |
| 3        | å°ã‚»ãƒ«å¤šæ•°åŒ–ï¼‹æœ‰ç·šãƒãƒƒã‚¯ãƒ›ãƒ¼ãƒ«    | é¢ç©æ‹¡å¤§/ç«¯æœ«å¢—ã«ç·šå½¢æ‹¡å¼µ          |
| 4        | ç›£è¦–/æœ€é©åŒ–ï¼ˆå‡ºåŠ›èª¿æ•´ãƒ»ãƒ­ã‚°åˆ†æï¼‰ | ãƒ­ãƒ¼ãƒŸãƒ³ã‚°å®‰å®šãƒ»æ··ç·šæ™‚ã®è¿…é€Ÿãªæ˜¯æ­£ |

å‚è€ƒ: ç«¯æœ«ã‚¢ãƒ—ãƒªå´ã®é€šä¿¡ã®ä½¿ã„åˆ†ã‘ãƒ»æ©Ÿèƒ½é€£æºã¯ `0313_ç«¯æœ«ã‚¢ãƒ—ãƒªï¼ˆãƒãƒ³ãƒ‡ã‚£ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ»ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼‰è¨­è¨ˆ.md` ã‚’å‚ç…§ã€‚

#### **8.1.4. OpenTelemetryã‚¤ãƒ³ãƒ•ãƒ©è¨­è¨ˆ**

##### **8.1.4.1. OpenTelemetry Collector DaemonSet**

```yaml
# OpenTelemetry Collector DaemonSet
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: otel-agent
  namespace: imageflow-observability
spec:
  selector:
    matchLabels:
      app: otel-agent
  template:
    metadata:
      labels:
        app: otel-agent
    spec:
      serviceAccount: otel-agent
      containers:
      - name: otel-agent
        image: otel/opentelemetry-collector-contrib:0.97.0
        args:
          - --config=/etc/otelcol-contrib/config.yaml
        volumeMounts:
        - name: config
          mountPath: /etc/otelcol-contrib
        - name: varlog
          mountPath: /var/log
          readOnly: true
        - name: varlibdockercontainers
          mountPath: /var/lib/docker/containers
          readOnly: true
        env:
        - name: KUBE_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: KUBE_POD_UID
          valueFrom:
            fieldRef:
              fieldPath: metadata.uid
        - name: KUBE_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        resources:
          requests:
            memory: 100Mi
            cpu: 100m
          limits:
            memory: 200Mi
            cpu: 200m
        ports:
        - containerPort: 4317  # OTLP gRPC
        - containerPort: 4318  # OTLP HTTP
        - containerPort: 8888  # Prometheus metrics
      volumes:
      - name: config
        configMap:
          name: otel-agent-config
      - name: varlog
        hostPath:
          path: /var/log
      - name: varlibdockercontainers
        hostPath:
          path: /var/lib/docker/containers
      tolerations:
      - key: node-role.kubernetes.io/master
        operator: Exists
        effect: NoSchedule
```

##### **8.1.4.2. Grafana Tempoè¨­å®š**

```yaml
# Grafana Tempo for distributed tracing
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: tempo
  namespace: imageflow-observability
spec:
  serviceName: tempo
  replicas: 1
  selector:
    matchLabels:
      app: tempo
  template:
    metadata:
      labels:
        app: tempo
    spec:
      containers:
      - name: tempo
        image: grafana/tempo:2.4.0
        args:
          - -config.file=/etc/tempo/tempo.yaml
          - -mem-ballast-size-mbs=1024
        volumeMounts:
        - name: config
          mountPath: /etc/tempo
        - name: data
          mountPath: /var/tempo
        env:
        - name: TEMPO_STORAGE_TRACE_BACKEND
          value: "local"
        - name: TEMPO_STORAGE_TRACE_LOCAL_PATH
          value: "/var/tempo"
        resources:
          requests:
            memory: 1Gi
            cpu: 500m
          limits:
            memory: 2Gi
            cpu: 1000m
        ports:
        - containerPort: 3200  # HTTP
        - containerPort: 4317  # OTLP gRPC
        - containerPort: 14250 # Jaeger gRPC
      volumes:
      - name: config
        configMap:
          name: tempo-config
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes: ["ReadWriteOnce"]
      resources:
        requests:
          storage: 10Gi
```

### **8.2. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¨­è¨ˆ**

#### **8.2.1. MinIOè¨­å®š**

```yaml
# MinIOåˆ†æ•£æ§‹æˆ
apiVersion: v1
kind: ConfigMap
metadata:
  name: minio-config
  namespace: imageflow-storage
data:
  # åˆ†æ•£æ§‹æˆï¼ˆ4ãƒãƒ¼ãƒ‰ï¼‰
  MINIO_DISTRIBUTED_MODE: "true"
  MINIO_DISTRIBUTED_NODES: "4"
  
  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
  MINIO_REGION: "us-east-1"
  MINIO_BROWSER: "on"
  MINIO_DOMAIN: "minio.imageflow.local"
  
  # ãƒã‚±ãƒƒãƒˆè¨­å®š
  MINIO_DEFAULT_BUCKETS: |
    raw-images:rw
    processed-images:rw
    system-logs:r
```

#### **8.2.2. æ°¸ç¶šãƒœãƒªãƒ¥ãƒ¼ãƒ è¨­è¨ˆ**

```yaml
# StorageClasså®šç¾©
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast-ssd
provisioner: kubernetes.io/no-provisioner
volumeBindingMode: WaitForFirstConsumer
parameters:
  type: ssd
  iops: "3000"

---
# é«˜æ€§èƒ½ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç”¨PV
apiVersion: v1
kind: PersistentVolume
metadata:
  name: minio-data-01
spec:
  capacity:
    storage: 1Ti
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: fast-ssd
  hostPath:
    path: /data/minio/01
```

### **8.3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­è¨ˆ**

#### **8.3.1. Service Meshï¼ˆIstioï¼‰**

```yaml
# Istio VirtualService
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: imageflow-api
  namespace: imageflow-backend
spec:
  hosts:
  - api.imageflow.com
  gateways:
  - imageflow-gateway
  http:
  - match:
    - uri:
        prefix: /v1/
    route:
    - destination:
        host: backend-api
        port:
          number: 8000
    fault:
      delay:
        percentage:
          value: 0.1
        fixedDelay: 5s
    retries:
      attempts: 3
      perTryTimeout: 10s
```

#### **8.3.2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒªã‚·ãƒ¼**

```yaml
# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: processing-isolation
  namespace: imageflow-processing
spec:
  podSelector:
    matchLabels:
      tier: processing
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: imageflow-backend
    ports:
    - protocol: TCP
      port: 8080
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: imageflow-storage
    ports:
    - protocol: TCP
      port: 9000  # MinIO
```
