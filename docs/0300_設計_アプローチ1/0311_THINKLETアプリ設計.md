# THINKLET アプリ設計書

# 文書管理情報

| 項目       | 内容                  |
| ---------- | --------------------- |
| 文書名     | THINKLET アプリ設計書 |
| バージョン | 1.1                   |
| 作成日     | 2025年8月7日          |
| 更新日     | 2025年8月11日         |

---

# 1. 概要

## 1.1. 本書の目的

本書は、ImageFlowCanvasシステムにおけるTHINKLETウェアラブルデバイス向けアプリケーションの詳細設計について記述するものです。THINKLETの特性を最大限に活用したセンサーデータ処理と端末アプリ連携機能（ハンディターミナル・デスクトップ）の実装指針を提供します。

## 1.2. 対象読者

- THINKLETアプリ開発者
- ウェアラブルデバイス技術者
- システム設計者
- 品質保証担当者

## 1.3. THINKLETアプリの特徴

THINKLETアプリは、端末アプリ（ハンディターミナル・デスクトップ）との密接な連携により、以下の特徴を持つ特化型アプリケーションです：

- **センサーデータ処理**: 装着者視点でのリアルタイム環境データ収集・解析
- **ハンズフリー操作**: 音声コマンドとジェスチャー制御（UI操作は連携端末で実施）
- **連携端末のセンサー役**: 端末アプリ（ハンディターミナル・デスクトップ）の映像・音声・センサー拡張機能
- **超低遅延**: <20ms の映像処理とフィードバック（連携端末経由表示）
- **バッテリー最適化**: 8時間連続稼働を実現
- **端末アプリ連携**: リアルタイム検査結果の端末アプリ表示（ハンディターミナル・デスクトップ対応）

---

# 2. THINKLET デバイス仕様と制約

## 2.1. ハードウェア仕様

### 2.1.1. 基本性能

| 項目           | 仕様                            | 設計への影響                           |
| -------------- | ------------------------------- | -------------------------------------- |
| **OS**         | Fairy OS（AOSP ベースの独自OS） | Android SDK互換、Kotlin対応            |
| **CPU**        | Qualcomm Snapdragon シリーズ    | 中程度の処理能力、効率重視設計が必要   |
| **RAM**        | 4GB                             | メモリ効率の最適化が重要               |
| **ストレージ** | 64GB+128GB（オンボードSDXC）    | ローカルキャッシュとオフライン対応可能 |
| **重量**       | 約170g                          | 軽量化設計、バッテリー消費最適化       |
| **バッテリー** | 1350 mAh                        | 省電力アーキテクチャが必須             |

### 2.1.2. カメラ性能

| 項目                   | 仕様                 | 活用方法                 |
| ---------------------- | -------------------- | ------------------------ |
| **解像度**             | 8MP                  | 高精細な検査画像の取得   |
| **視野角（横広角機）** | 水平120度×垂直90度   | 広範囲作業エリアのカバー |
| **視野角（縦広角機）** | 水平90度×垂直120度   | 縦長対象物の検査に最適   |
| **画像安定性**         | 肩掛け固定による安定 | 手ブレのない安定した映像 |

### 2.1.3. 音声機能

| 項目             | 仕様                              | 活用方法                         |
| ---------------- | --------------------------------- | -------------------------------- |
| **マイク**       | 5ch マイクアレイ、48kHz/24bit相当 | 高品質音声入力、騒音抑制         |
| **XFE技術**      | 環境騒音抑制、装着者音声抽出      | 工場騒音下での確実な音声認識     |
| **スピーカー**   | 1ch 内蔵スピーカー                | 音声フィードバック、アラート通知 |
| **外部音声出力** | Bluetooth、有線イヤホン対応       | 騒音環境での確実な情報伝達       |

### 2.1.4. センサー

| センサー          | 用途             | 検査アプリでの活用             |
| ----------------- | ---------------- | ------------------------------ |
| **9軸モーション** | 姿勢、動作検出   | 作業状態分析、装着状態監視     |
| **近接センサー**  | 装着検出         | アプリ自動起動、省電力制御     |
| **ジェスチャー**  | ハンズフリー操作 | 検査開始/停止、画面操作        |
| **GNSS**          | 位置情報取得     | 検査場所記録、トレーサビリティ |

## 2.2. 環境制約

### 2.2.1. 物理環境

- **防塵性能**: IP5X相当 → 粉塵の多い工場環境での使用
- **防水性能**: IPX4 → 飛沫のある環境での使用
- **動作温度**: 工場・建設現場の温度変化に対応
- **振動耐性**: 機械作業時の振動に耐える構造

### 2.2.2. ネットワーク環境

- **4G/LTE**: Band 1/3/8/9/18/19/41 対応
- **Wi-Fi**: 2.4GHz/5GHz デュアルバンド（現場では5GHz/20MHz/非DFS/低出力の小型AP設計を標準採用）
- **オフライン対応**: ネットワーク不安定環境での継続動作

注: 現場ネットワークの詳細設計・運用は `0307_インフラ設計.md` の「8.1.3. 現場ネットワーク設計（小型AP＋有線バックホール）」を参照。

---

# 3. アプリケーション アーキテクチャ

## 3.1. 全体構成

```mermaid
graph TB
    subgraph "THINKLET デバイス"
        subgraph "アプリケーション層"
            UILayer[連携インターフェース層<br/>• 音声UI<br/>• ジェスチャーUI<br/>• 端末アプリ連携UI]
            BusinessLayer[Business Logic Layer<br/>• 検査ワークフロー<br/>• 一人称映像処理<br/>• ハンディターミナル協調制御]
        end
        
        subgraph "プラットフォーム層"
            CameraService[Camera Service<br/>• 一人称映像取得<br/>• リアルタイムストリーム<br/>• 録画機能]
            AudioService[Audio Service<br/>• 5chマイク制御<br/>• XFE音声処理<br/>• 音声フィードバック]
            SensorService[Sensor Service<br/>• 装着状態監視<br/>• 作業状態分析<br/>• 位置情報取得]
            GestureService[Gesture Service<br/>• 手/頭ジェスチャー認識<br/>• IMU/カメラ融合<br/>• マッピング/デバウンス]
            NetworkService[Network Service<br/>• gRPC通信<br/>• オフライン同期<br/>• WebRTCストリーミング]
        end
        
        subgraph "THINKLET SDK"
            ThinkletHardware[THINKLET Hardware APIs<br/>• カメラ制御<br/>• マイクアレイ<br/>• センサー統合<br/>• 電源管理]
            XFELibrary[XFE Library<br/>• 騒音抑制<br/>• 音声抽出<br/>• 適応制御]
        end
    end
    
    subgraph "ImageFlowCanvas Backend + ハンディターミナル"
        HandyTerminal[ハンディターミナルアプリ<br/>• UI表示・操作<br/>• 検査管理<br/>• 順序情報管理<br/>• THINKLET制御]
        APIGateway[API Gateway<br/>• gRPC Endpoint<br/>• WebRTC Signaling<br/>• 認証・認可]
        AIProcessing[AI Processing Pipeline<br/>• リアルタイム解析<br/>• 不良品検出<br/>• 信頼度判定]
        DataStorage[Data Storage<br/>• 検査結果保存<br/>• 映像アーカイブ<br/>• メタデータ管理]
    end
    
    %% デバイス内通信
    UILayer --> BusinessLayer
    BusinessLayer --> CameraService
    BusinessLayer --> AudioService  
    BusinessLayer --> SensorService
  BusinessLayer --> GestureService
    BusinessLayer --> NetworkService
    
    CameraService --> ThinkletHardware
    AudioService --> ThinkletHardware
    AudioService --> XFELibrary
    SensorService --> ThinkletHardware
  GestureService --> ThinkletHardware
    
    %% 混線回避通信アーキテクチャ
    NetworkService -->|gRPC<br/>検査データ・設定同期| APIGateway
    NetworkService -.->|ローカルWi-Fi（小型AP）<br/>暗号化・認証<br/>リアルタイム制御| HandyTerminal
    APIGateway --> AIProcessing
    AIProcessing --> DataStorage
    HandyTerminal -->|検査データ永続化| APIGateway
    
    %% 混線回避フィードバックループ
    AIProcessing -.->|検査結果<br/>サーバー経由| NetworkService
    HandyTerminal -.->|即座フィードバック<br/>ローカルWi-Fi(AP)暗号化| AudioService
    NetworkService -.->|音声・視覚フィードバック| AudioService
    
    %% デスクトップ連携（サーバー経由）
    AIProcessing -.->|判定結果配信| DesktopApp[端末アプリ<br/>• 1対1 THINKLET連携<br/>• リアルタイム制御<br/>• 検査結果表示<br/>• 操作インターフェース]
    DataStorage -.->|履歴データ| DesktopApp
    
    %% Web監視システム（複数デバイス管理）
    AIProcessing -.->|集約データ| WebApp[Web監視アプリ<br/>• 複数THINKLET監視<br/>• 統計分析ダッシュボード<br/>• アラート管理<br/>• レポート生成]
    DataStorage -.->|統計データ| WebApp
```

## 3.2. レイヤー構成

### 3.2.1. 端末アプリ連携インターフェース層（ハイブリッド通信）

THINKLETは画面を持たないため、端末アプリ（ハンディターミナル・デスクトップ）との密接なハイブリッド連携により以下のインターフェースを提供します：

**音声インターフェース（XFE音声処理・無線混線回避設計）:**
- 主要コマンド: 「検査開始」「検査停止」「次の項目」「結果確認」「ヘルプ」（暗号化通信で即座実行）
- 製品音声入力: 「型式 TYPE-ABC」「機番 MACH001」（同一SSID運用下で端末アプリ連携）
- 状況報告: 「検査完了しました」「不良を検出しました」「接続を確認してください」（混線なし直接フィードバック）
- フィードバック: 認識時の音声応答・端末アプリ画面更新連動（暗号化通信）
- データ記録: 音声コマンド履歴のサーバー同期（後処理）

**ジェスチャーインターフェース（カメラ+IMU統合・無線混線回避設計）:**
- 検査制御: 首振り（次の検査項目）、うなずき（検査開始・確認）（近接認証即座実行）
- 操作制御: 手を上げる（一時停止）、指差し（対象選択・端末アプリでの詳細表示）
- システム制御: 装着状態による自動開始・停止（緊急時対応）
- フィードバック: 認識時の音声・振動、端末アプリ画面のハイライト連動（混線回避通信）
- 学習データ: ジェスチャーパターンのサーバー蓄積・AI改善（バックグラウンド）

**端末アプリ連携インターフェース（混線回避ハイブリッド同期）:**
- リアルタイム状態同期: THINKLETの装着状態・バッテリー・接続状況の暗号化通信表示
- 検査制御: 端末アプリからのTHINKLET検査開始・停止・設定変更（個別認証実行）
- 結果表示: AI検査結果・詳細情報の端末アプリ画面表示（サーバー経由データ）
- 設定同期: 端末アプリでの設定変更の即座反映（暗号化）+ 永続化（サーバー）
- オフライン対応: ネットワーク障害時のローカル継続・後同期

**フィードバックシステム（端末アプリ協調・混線回避通信優先）:**
- **LEDフィードバック**: デバイス状態表示（暗号化通信制御）
  - 青色光: 正常動作中・端末アプリ暗号化接続済み
  - 赤色光: 不良検出アラート・端末アプリ緊急表示（混線なし即座反応）
  - 緑色光: 検査完了通知・端末アプリ完了画面
- **音声フィードバック**: 状況に応じた音声案内（端末アプリ設定の暗号化連動）
- **振動フィードバック**: 緊急時のアラートパターン（専用周波数・遅延なし）

### 3.2.2. Business Logic Layer（端末アプリ連携統合・混線回避方式）

センサーデータ処理管理では、THINKLETの特性を活かしたリアルタイムデータ収集機能と、端末アプリ（ハンディターミナル・デスクトップ）との密接な混線回避連携を実装します。

**センサーデータ検査の実行フロー（端末アプリ混線回避連携）:**
1. **装着状態確認**: センサーによる適切な装着状態の検証（ローカル処理）
2. **端末アプリ接続**: ローカルWi‑Fi（小型AP）での暗号化接続・認証（混線回避設計）
3. **製品情報受信**: 端末アプリから順序情報を受信（同一SSID運用・暗号化通信）
   - **順序情報同期**: 型式・機番・月連番等の検査対象情報（即座同期・認証済み）
   - **検査項目受信**: 端末アプリで設定された検査項目リスト（暗号化転送）
   - **作業指示受信**: 検査手順・注意事項の受信（混線なし通信）
4. **センサーデータ収集開始**: 環境データ・動作データの継続取得・バックエンド送信（サーバー経由永続化）
5. **音声/ジェスチャー監視**: 音声コマンドとジェスチャー入力の同時監視（近接認証実行）
6. **リアルタイムAI処理**: バックエンドでの並列データ解析（サーバー経由）
7. **端末アプリ結果配信**: 検査結果の直接配信 + サーバー経由永続化

**端末アプリ混線回避連携機能:**
- **自動デバイス検出**: 端末アプリの自動検出・接続（ローカルWi‑Fi/AP暗号化）
- **順序情報自動同期**: 端末アプリで選択された製品情報の即座受信（同一SSID運用） + サーバー記録
- **検査状態同期**: THINKLETの装着状態・検査状況のリアルタイム表示（混線なし通信）
- **操作指示受信**: 端末アプリからの検査開始・停止・切替指示（近接認証実行）
- **結果配信**: 検査結果の即座転送（暗号化）+ データ永続化（サーバー）
- **オフライン継続**: ネットワーク障害時の基本機能維持・後同期

**混線回避通信方式の利点:**

| 通信レイヤー     | ローカルWi‑Fi（小型AP）直結の利点 | サーバー経由の利点         | 統合効果               |
| ---------------- | ------------------------------- | -------------------------- | ---------------------- |
| **制御応答性**   | 低遅延・ローミング対応            | 安定性・エラー処理         | 高速確実・干渉抑制制御 |
| **データ管理**   | 暗号化保存・高速アクセス          | 永続化・監査証跡           | セキュア処理・追跡可能 |
| **可用性**       | 設計による干渉抑制・継続           | 統合管理・Web監視連携      | 継続性と統合監視       |
| **セキュリティ** | 認証・暗号化                     | サーバー認証・アクセス制御 | 多層防御・混線防止     |

**混線回避通信品質保証メカニズム:**
- **無線品質監視**: AP/チャネル/RSSI/遅延の品質監視（詳細はインフラ設計参照）
- **チャネル計画準拠**: 5GHz/20MHz/非DFS固定・出力最適化（設計で干渉抑制）  
- **暗号化認証**: デバイス固有認証・誤接続完全防止
- **データ整合性**: 重複排除・競合解決・最終一貫性確保

**フレーム処理とフィードバック（端末アプリ連携）:**
- 映像フレームへのメタデータ付与（端末アプリ提供の製品情報、位置情報、デバイス姿勢、環境データ）
- 端末アプリ指定の検査項目に基づくAI処理パイプライン適用
- 検査結果の端末アプリ即座送信
- 端末アプリ経由での音声・振動フィードバック制御
- 詳細結果・操作画面の端末アプリ表示

**重要検査結果の緊急フィードバック（端末アプリ連携）:**
- **重大欠陥検出**: THINKLETアラート音 + 端末アプリ緊急画面表示 + 音声案内
- **一般欠陥検出**: THINKLETアラート音 + 端末アプリ警告表示 + 詳細情報表示
- **軽微欠陥検出**: 端末アプリ通知表示のみ

**端末アプリ連携機能（統合制御）:**
- **検査結果自動送信**: 検査結果・分析データの端末アプリ自動転送
- **製品別判定結果表示**: <100ms遅延での製品特定AI判定結果表示
- **製品トレーサビリティアラート**: 製品情報紐づけ不良検出時の緊急通知
- **製品別統計データ送信**: 製品タイプ・機番別検査パフォーマンスデータの定期送信

**製品情報管理専用機能:**
- **QRコード一人称認識**: THINKLETカメラによる動的QRコードスキャン
- **製品履歴自動記録**: 映像開始/終了時の製品トレーサビリティ自動更新
- **音声製品確認**: 「現在の製品: 型式 TYPE-ABC、機番 MACH001」の音声読み上げ
- **製品切り替え通知**: 異なる製品QRコード検出時の自動切り替えアラート

### 3.2.3. Camera Service (一人称映像特化)

THINKLET専用カメラサービスでは、広角カメラを活用した一人称映像処理を最適化します。

**一人称映像ストリーミング機能:**
- **最適カメラ設定**: 8MP解像度、30fps、高品質映像
- **視野角最適化**: 作業環境に応じた最適視野角の自動選択
- **映像安定化**: 肩掛け固定に対応した手ブレ補正
- **自動調整**: オートフォーカス、自動露出、低照度最適化

**作業環境別視野角選択:**
- **組立ライン作業**: 横広角（120度×90度）- 作業台全体をカバー
- **縦型検査作業**: 縦広角（90度×120度）- 縦長対象物に最適化
- **詳細検査作業**: 標準視野角 - 細部作業に集中
- **デフォルト**: 横広角設定

**一人称映像の前処理:**
- フレームID生成とタイムスタンプ付与
- デバイス姿勢情報の付与
- 照明状態とフォーカス品質の分析
- 作業コンテキストの記録

**バッテリー効率録画:**
- 圧縮品質のバッテリー最適化
- 最大8時間連続録画対応
- 音声付き録画機能

### 3.2.4. Audio Service (XFE技術活用)

THINKLET音声サービスでは、XFE技術を活用した高性能音声処理を実現します。

**音声コマンド検出（XFE技術活用）:**
- **5chマイクアレイ設定**: 48kHz/24bit高品質音声収集
- **XFE音声前処理**: 
  - 工場騒音抑制機能
  - 装着者音声抽出機能
  - 適応音量制御機能
  - 風切り音抑制機能

**工場騒音下での音声コマンド認識:**
- **高精度認識**: 日本語音声認識（信頼度閾値0.8以上）
- **騒音耐性**: 高騒音環境対応設計
- **専用語彙**: 検査業務特化語彙セット

**検査専用音声コマンド語彙:**
- 検査制御: 「検査開始」「検査終了」「緊急停止」
- 撮影制御: 「撮影」「録画開始」「録画停止」
- 結果確認: 「結果確認」「不良報告」

**環境騒音対応音声フィードバック:**
- **適応音量調整**: 環境騒音レベルに応じた自動音量調整
- **音声品質最適化**: 音声認識向け高明度設定
- **緊急時対応**: 重要度に応じた繰り返し回数調整
  - 緊急時（Critical）: 3回繰り返し
  - 高優先度（High）: 2回繰り返し
  - 通常（Normal）: 1回のみ

---

### 3.2.5. Gesture Service (ジェスチャー認識)

THINKLETのカメラとIMU（加速度/ジャイロ）を融合し、ハンズフリー操作を実現します。

**役割:**
- 手/指/頭部の動作からジェスチャーを検出し、業務コマンドへ変換
- 誤検知抑制、環境ロバスト性、低遅延動作の両立

**入出力（契約）:**
- 入力: カメラフレーム（省電力時は縮小/間引き）、IMUストリーム（100Hz）、装着/環境状態
- 出力: GestureEvent { type, confidence, timestamp, duration, source }、Telemetry（latencyMs, f1Rolling, cpu%, battDrain/h）
- エラー: SensorUnavailable, LowConfidence, OverheatThrottled

**処理パイプライン:**
1. 前処理: 手領域推定（手袋対応閾値）、IMUフィルタリング（ローパス/補償）
2. 特徴抽出: 手指キーポイント/骨格、動きベクトル、首振り/うなずき検出
3. センサーフュージョン: 連続時系列の統合推定（Complementary Filter/HMM）
4. 分類: ルール + 軽量ML（TFLite/ONNX）ハイブリッド
5. ポスト処理: デバウンス、ダブルアクション（ホールド+動作）、領域/姿勢制約
6. マッピング: Gesture→Command（業務プリセット/カスタム）
7. フィードバック: 成功/失敗の音声/振動、ハンディターミナル画面ハイライト

**誤検知低減と安全:**
- 信頼度しきい値θ=0.8（省電力時0.85）、連続フレームN=3-5
- 危険環境フラグ中は一部ジェスチャー無効化、重大操作は意図確認を要求

**キャリブレーション:**
- 初回ウィザード（利き手・可動域・装着角度）、3秒クイック再調整、プロファイル保存/同期

**ジェスチャーマップ:**
- プリセット（検査/撮影/ナビ/マーカー）、現場別/個人別カスタム、監査ログ出力

**省電力モード:**
- 高性能: カメラ+IMU常時、有効遅延<150ms
- バランス: 低解像度カメラ前処理+IMU優先、遅延<200ms
- 省電力: IMU中心（首振り/うなずき/傾き）、必要時のみカメラ起動

## 3.3. リアルタイム処理アーキテクチャ

### 3.3.1. 超低遅延ストリーミング

超低遅延映像ストリーミング（20ms未満）では、高効率な並列処理により高性能を実現します。

**超低遅延ストリーミング機能:**
- **フレーム送信時刻記録**: 遅延測定用タイムスタンプ付与
- **バッファリング最適化**: 30フレームチャンク単位での効率処理
- **並列処理**: 複数フレームの同時処理によるスループット向上
- **遅延監視**: 20ms閾値超過時の警告機能

**リアルタイム処理フロー:**
1. 映像フレームの受信とタイムスタンプ記録
2. 30フレーム単位でのチャンク処理
3. gRPCストリーミングによるバックエンド送信
4. 並列AI処理の実行
5. 遅延測定と性能監視
6. エラー時のローカル処理フォールバック

### 3.3.2. オフライン処理対応

ネットワーク切断時には、ローカルAI処理による業務継続性を確保します。

**オフライン処理機能:**
- **軽量ローカルAI**: 基本的な検査機能をローカルで実行
- **データ保存**: 検査結果をローカルデータベースに一時保存
- **同期状態管理**: ネットワーク復旧時の自動同期準備

**ネットワーク復旧時同期:**
- **保留レコード処理**: ローカル保存された未同期データの自動送信
- **サーバー再処理**: 高精度AIによる再解析実行
- **結果更新**: ローカル結果の高精度バージョンへの更新
- **エラーハンドリング**: 同期失敗時のリトライキュー管理

---

# 4. THINKLET固有バッテリー・熱制御

## 4.1. THINKLET特化バッテリー管理

THINKLET固有の1350mAhバッテリーにおいて、8時間連続稼働を実現するための最適化戦略を実装します。

**THINKLET用電力配分:**
- **カメラシステム**: 全消費電力の40%（映像処理とストリーミング）
- **音声処理（XFE）**: 全消費電力の25%（5chマイクアレイとXFE処理）
- **センサー統合**: 全消費電力の15%（9軸モーション、近接、GNSS）
- **通信モジュール**: 全消費電力の15%（4G/LTE、Wi-Fi）
- **その他システム**: 全消費電力の5%（OS、アプリ処理）

**8時間稼働目標の動的調整:**
- **現在残量監視**: 30分間隔でのバッテリーレベルチェック
- **予測消費量計算**: 現在の使用パターンから8時間後の残量予測
- **段階的制限**: 予測残量に応じた機能制限の段階的適用

## 4.2. THINKLET熱制御

工場・建設現場の過酷環境におけるデバイス温度管理を実現します。

**環境別熱制御:**
- **屋内作業（25-35℃）**: 標準動作、最大性能維持
- **屋外作業（35-45℃）**: 軽度制限、フレームレート調整
- **高温環境（45-55℃）**: 中度制限、解像度・処理能力調整
- **危険環境（55℃超）**: 重度制限、緊急保護モード

---

# 5. 作業状態監視

## 5.1. 装着状態検出

装着状態の継続監視により、適切な機器使用状況を確保します。

**装着状態監視機能:**
- **近接センサー監視**: 身体接触の継続検出
- **モーションセンサー監視**: デバイスの動作安定性測定
- **姿勢センサー監視**: デバイスの装着角度・向き確認
- **統合判定**: 複数センサーデータの組み合わせ評価

**不適切装着の検出:**
- **装着なし**: デバイスが身体から離れている状態
- **不安定装着**: 振動や揺れによる不安定な装着状態
- **傾斜装着**: 30度を超える傾斜での装着状態
- **不確実状態**: センサー信頼度が低い状態

## 5.2. 作業分析

作業パターンの分析により、作業効率と品質の向上を支援します。

**作業パターン分析機能:**
- **活動分類**: モーションデータから作業活動の種類を判定
- **作業エリア分析**: 映像から作業対象領域を特定
- **作業強度計算**: 動作データから作業負荷を測定
- **効率性評価**: 作業パターンと成果の相関分析

**作業効率指標:**
- **生産性スコア**: 活動パターンに基づく生産性評価
- **集中度レベル**: 作業エリアへの注意集中度測定
- **動作効率性**: 無駄な動作の検出と改善提案
- **総合効率性**: 全体的な作業効率の統合評価

---

# 6. 技術アーキテクチャ

## 6.1 混線回避対応技術スタック

```
[THINKLETアプリ アーキテクチャ - 多作業者対応]

┌─────────────────────────────────────────────────┐
│                プレゼンテーション層                 │
├─────────────────────────────────────────────────┤
│ センサーUI    │ 音声UI    │ ジェスチャーUI        │
│ (Compose MP)  │(音声処理) │ (センサー統合)        │
├─────────────────────────────────────────────────┤
│                ビジネスロジック層                   │
├─────────────────────────────────────────────────┤
│ 検査制御   │ データ処理 │ 状態管理 │ 無線管理      │
│ (共通Logic)│ (KMP共通) │(共通状態)│(混線回避)      │
├─────────────────────────────────────────────────┤
│                   通信層                         │
├─────────────────────────────────────────────────┤
│ ローカルWi‑Fi(AP) │ HTTP通信  │ 暗号化処理│ 認証管理    │
│ (同一SSID)       │(サーバー) │(AES-256) │(干渉防止)   │
├─────────────────────────────────────────────────┤
│                データアクセス層                     │
├─────────────────────────────────────────────────┤
│ ローカルDB   │ 設定管理  │ ファイル  │ 混線管理DB  │
│ (SQLite)     │(Prefs)    │(一時保存) │(デバイス情報)│
└─────────────────────────────────────────────────┘
```

## 6.2 混線回避通信アーキテクチャ

| レイヤー               | 技術仕様          | 混線回避仕様                |
| ---------------------- | ----------------- | --------------------------- |
| **ローカル直結**       | ローカルWi‑Fi（小型AP） | 同一SSID・暗号化・認証       |
| **プロトコル**         | TCP/UDP + TLS 1.3 | AES-256暗号化・デバイス認証 |
| **サーバー通信**       | HTTPS + WebSocket | TLS暗号化・トークン認証     |
| **データシリアライズ** | Protocol Buffers  | データ暗号化・整合性検証    |
| **ローカルストレージ** | SQLite Encrypted  | 暗号化DB・デバイス固有鍵    |

## 6.3 1対1端末連携 + Web監視アーキテクチャ

```
[混線回避通信フロー図 - 1対1端末連携 + Web監視]

THINKLET-端末ペア     ローカルWi‑Fi（小型AP）       端末アプリ
┌─────────────┐      (同一SSID/WPA2/3)        ┌─────────────┐
│ THINKLET-A  │◄────────────────────────►│ Terminal-A  │
│ (個別認証)  │      1対1直接通信          │ (専用制御)  │
└─────────────┘                           └─────────────┘
       │                                         │
       ▼                                         ▼
┌─────────────────────────────────────────────────────┐
│           バックエンドサーバー（統合管理）              │
│     ┌─────────────┬─────────────┬─────────────┐    │
│     │ データ統合  │ 状態同期    │ 監査ログ    │    │
│     │ (永続化)    │ (整合性)    │ (証跡管理)  │    │
│     └─────────────┴─────────────┴─────────────┘    │
└─────────────────────────────────────────────────────┘
                           │
                           ▼
                 ┌─────────────────┐
                 │   Web監視システム   │
                 │ ・複数THINKLET監視 │
                 │ ・統計分析        │
                 │ ・アラート管理    │
                 │ ・レポート生成    │
                 └─────────────────┘
```

## 6.4 Kotlin Multiplatform実装アーキテクチャ

```
[KMP共有アーキテクチャ]

┌─────────────────────────────────────────────┐
│          共通ビジネスロジック (90%+)          │
├─────────────────────────────────────────────┤
│ • センサーデータ処理    • ローカルWi‑Fi(AP)制御 │
│ • 検査ワークフロー      • AI解析パイプライン │
│ • 状態管理              • データ同期        │
│ • 暗号化・認証          • エラーハンドリング │
└─────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────┐
│           プラットフォーム固有実装           │
├─────────────────┬───────────────────────────┤
│  Android THINKLET │  Windows/Linux/macOS端末  │
│  ・センサー統合   │  ・1対1 THINKLET制御      │
│  ・カメラ制御     │  ・リアルタイム操作UI     │
│  ・ローカルWi‑Fi(AP)│  ・検査結果表示           │
│  ・電力最適化     │  ・状態監視ダッシュボード  │
└─────────────────┴───────────────────────────┘

注: 複数デバイス監視・統計分析・レポート機能は
    別途Webアプリケーションで提供
```

---

# 7. 緊急時対応

## 7.1. 異常検知

緊急事態の自動検出により、作業者の安全を確保します。

**緊急事態検出機能:**
- **動作センサー分析**: 急激な落下や異常な動作パターンの検出
- **音声分析**: 異常音（爆発音、警報音）や救助要請の検出
- **映像分析**: 火災・煙・危険物の視覚的検出
- **行動分析**: 長時間の静止状態や意識不明の可能性検出

**検出対象の緊急事態:**
- **急激な落下**: 転倒や事故による急激な姿勢変化
- **異常音検出**: 工場警報や危険を示す音響信号
- **作業者意識不明**: 長時間の静止状態
- **火災検出**: 炎や煙の映像解析
- **救助要請**: 作業者の呼び声や救助信号

## 7.2. 緊急通報機能

緊急事態発生時の自動対応により、迅速な救助活動を支援します。

**緊急事態発生時の自動対応フロー:**
1. **緊急通報**: 即座のアラート送信
2. **音声警告**: 緊急事態の音声案内
3. **証拠映像保存**: 事故状況の記録保存
4. **位置追跡開始**: 継続的な位置情報送信
5. **緊急連絡先通知**: 関係者への自動通知

**緊急データ収集項目:**
- 事象タイプ、発生時刻、位置情報
- デバイスID、作業者ID
- バイタルサイン、環境データ

**緊急時映像録画:**
- **録画時間**: 10分間の自動録画
- **品質設定**: 高品質での証拠保全
- **音声付き**: 現場音声の同時記録
- **自動アップロード**: サーバーへの即座転送



---

# 8. THINKLET固有テスト戦略

## 8.1. ハードウェア統合テスト

THINKLET固有のハードウェア機能に対する包括的なテスト戦略を実装します。

**一人称映像キャプチャーテスト:**
- **映像ストリーム検証**: 30フレーム/秒での安定ストリーミング
- **視野角確認**: 横広角120度×90度、縦広角90度×120度の切り替え
- **XFE音声処理検証**: 85dB騒音環境での音声認識精度テスト
- **装着者音声抽出**: 5chマイクアレイによる選択的音声集音検証

**ジェスチャー認識統合テスト:**
- **遅延計測**: カメラ+IMU融合でのエンドツーエンド<200ms検証
- **精度評価**: 主要ジェスチャーでF1>0.95（標準環境）確認
- **環境ロバスト性**: 手袋着用、強照度、振動環境での安定性テスト
- **省電力動作**: バッテリーモードごとの機能切替確認

## 8.2. 過酷環境テスト

工場・建設現場での長時間稼働における安定性と耐性を検証します。

**環境耐性テスト:**
- **防塵性能**: IP5X相当での粉塵環境テスト
- **防水性能**: IPX4での飛沫環境テスト
- **温度耐性**: 45-55℃環境での熱制御機能検証
- **振動耐性**: 機械作業時の振動下での動作確認

**8時間連続稼働テスト:**
- **バッテリー管理**: 1350mAhでの8時間稼働検証
- **熱制御**: 長時間動作での過熱防止機能確認
- **データ整合性**: 長時間録画でのデータ欠損防止確認

---

# 8. デプロイメント・運用

## 8.1. THINKLET専用アプリ配布

THINKLET専用アプリケーションの配布とTHINKLET固有の運用監視を提供します。

**THINKLET固有配布仕様:**
- **ターゲットOS**: Fairy OS（AOSP ベース）
- **THINKLET固有権限**:
  - 5chマイクアレイアクセス権限
  - XFE処理ライブラリアクセス権限
  - 広角カメラ統合制御権限
  - ジェスチャーセンサー統合権限

**Fairy OS固有設定:**
- **XFE機能**: 有効化設定
- **バッテリー最適化**: 8時間稼働対応
- **熱管理**: 工場環境での安定動作保証

**THINKLETネイティブライブラリ:**
- THINKLET SDK ライブラリ
- XFE音声処理ライブラリ
- 軽量ジェスチャー推論モデル（TFLite/ONNX）

## 8.2. THINKLET運用監視

THINKLETデバイスの健康状態と運用状況を包括的に監視します。

**THINKLET固有監視項目:**
- **XFE音声処理**: 騒音抑制効果、音声認識精度
- **ジェスチャー認識**: 認識遅延、信頼度平均、誤検知率
- **装着状態**: 適切な装着状況の継続確認
- **視野角状態**: 横広角・縦広角の自動切り替え状況
- **一人称映像品質**: フレームレート、解像度、手ブレ補正状況

---

# 9. まとめ

## 9.1. THINKLETアプリの価値

本設計に基づくTHINKLETアプリは、以下の革新的価値を提供します：

1. **一人称映像による品質検査革命**
   - 装着者視点でのリアルタイム品質判定
   - ハンズフリーでの検査業務実行
   - 作業プロセスの自動記録・分析

2. **過酷環境での安定稼働**
   - 工場・建設現場での8時間連続動作
   - 騒音環境下での確実な音声認識
   - 防塵防水性能による環境耐性

3. **超低遅延フィードバック**
   - 20ms以下のリアルタイム検査結果
   - 即座の音声・視覚フィードバック
   - 緊急時の自動対応機能

4. **ハンディターミナル統合連携**
   - ハンディターミナルでの統合制御・結果表示
   - 検査データ・分析結果のハンディターミナル表示
   - 現場作業者向けの直感的操作インターフェース

## 9.2. 技術的達成点

- **XFE技術の活用**: 工場騒音下での高精度音声認識
- **バッテリー最適化**: 1350mAhで8時間稼働を実現
- **熱管理**: 過酷環境での安定動作
- **オフライン対応**: ネットワーク不安定環境での業務継続

## 9.3. 今後の拡張可能性

- **他ウェアラブルデバイス対応**: Google Glass、HoloLensなどへの展開
- **AI機能強化**: デバイス内AIによる即座判定
- **作業分析高度化**: 作業効率・安全性の詳細分析
- **多言語対応**: グローバル展開に向けた言語サポート

この設計により、THINKLETアプリはウェアラブルデバイスとハンディターミナルが連携した次世代品質管理システムの先駆けとなり、製造業のDXに大きく貢献することが期待されます。特に、一人称映像のリアルタイム解析とハンディターミナルアプリでの統合制御により、現場作業者が効率的に品質管理プロセスを実行できるシステムを実現します。
